if(typeof NHS=="undefined"){NHS={};NHS.Scripts={}}NHS.Scripts.GoogleMapApi=function(b){var a={};jQuery.extend(true,a,this.defaultOptios);this.options=jQuery.extend(true,a,b);this.markersArray=[];this.infowindow=new google.maps.InfoWindow(this.options.InfoWindowOptions);this.infowindowTooltip=new google.maps.InfoWindow(this.options.InfoWindowOptions);this.map=null;this.bounds=new google.maps.LatLngBounds;this.isMapCreate=false};NHS.Scripts.GoogleMapApi.prototype={defaultOptios:{MapOptions:{Latitude:null,Longitude:null,Zoom:8,ContainerName:"map-canvas",zoomControl:true,ZoomControlStyle:"LARGE",zoomControlPosition:null,disableDefaultUI:false,Draggable:true,Scrollwheel:true,DisableDoubleClickZoom:false,panControl:false,overviewControl:false,streetViewControl:false},CreateMapWrap:true,DirectionsDisplayPanel:null,MarkerPointOptions:{optimized:true},Loader:"",MinZoom:3,MaxZoom:null,MarkerClustererOptions:{gridSize:50,maxZoom:15,cssName:null,imagePath:null,zoomOnClick:true,minimumClusterSize:null},UseClusterer:false,InfoWindowOptions:{disableAutoPan:false},MarkerPointAsynOptions:{Listener:"idle",UrlServer:null},ProcessResultOptions:{Latitude:"",Longitude:"",Name:""},Events:{OnMapCreate:null,OnMarkersCreate:null,OnMarkersRemove:function(){},OnGetMarkerPointAsyn:function(){},MarkerClickCallBack:null,IdleCallBack:null,MarkerMouseOverCallBack:null,MarkerMouseOutCallBack:null,ZoomChangesCallBack:null,DragChangesCallBack:null,ClickCallBack:null,InfowindowTooltipReadyCallBack:null,InfowindowReadyCallBack:null,tInfowindowOffsetCallBack:null},Autocomplete:{CreateControl:false,BindToBound:false,Autocompletecontrol:"pac-input"}},createMap:function(){var a=this,b=a.options.MapOptions,d=a.options.MarkerClustererOptions,c={zoom:b.Zoom,center:new google.maps.LatLng(b.Latitude,b.Longitude),zoomControl:b.zoomControl,zoomControlOptions:{style:google.maps.ZoomControlStyle[b.ZoomControlStyle],position:google.maps.ControlPosition[b.zoomControlPosition]},disableDefaultUI:b.disableDefaultUI,draggable:b.Draggable,scrollwheel:b.Scrollwheel,disableDoubleClickZoom:b.DisableDoubleClickZoom,panControl:b.panControl,streetViewControl:b.streetViewControl,overviewMapControl:b.overviewMapControl,maxZoom:a.options.MaxZoom,minZoom:a.options.MinZoom};a.options.CreateMapWrap&&a.createMapWrap();a.map=new google.maps.Map(document.getElementById(b.ContainerName),c);google.maps.Map.prototype.clearOverlays=function(){a.clearOverlays()};jQuery.isFunction(a.options.Events.ClickCallBack)&&google.maps.event.addListener(a.map,"click",function(){a.options.Events.ClickCallBack.call(a)});google.maps.event.addListener(a.map,"dragend",function(){jQuery.isFunction(a.options.Events.DragChangesCallBack)&&a.options.Events.DragChangesCallBack.call(a)});if(window["MarkerClusterer"])a.markerCluster=new MarkerClusterer(a.map,[],d);a.getMarkerPointAsyn();a.CreateOverlay();jQuery.isFunction(a.options.Events.InfowindowTooltipReadyCallBack)&&google.maps.event.addListener(a.infowindowTooltip,"domready",function(){a.options.Events.InfowindowTooltipReadyCallBack.call(a)});jQuery.isFunction(a.options.Events.InfowindowReadyCallBack)&&google.maps.event.addListener(a.infowindow,"domready",function(){a.options.Events.InfowindowReadyCallBack.call(a)});jQuery.isFunction(a.options.Events.ZoomChangesCallBack)&&google.maps.event.addListener(a.map,"zoom_changed",function(){a.options.Events.ZoomChangesCallBack.call(a,a.map.getZoom())});google.maps.event.addListener(a.map,"idle",function(){a.RemoveGoogleInfo();jQuery.isFunction(a.options.Events.IdleCallBack)&&a.options.Events.IdleCallBack.call(a);jQuery.isFunction(a.options.Events.OnMapCreate)&&!a.isMapCreate&&a.options.Events.OnMapCreate();a.isMapCreate=true});google.maps.event.addListenerOnce(a.map,"tilesloaded",a.RemoveGoogleInfo)},createMapWrap:function(){var a=this,b=a.options.MapOptions;jQuery("#"+b.ContainerName).wrap('<div id="nhs_mapwrap" style="position:relative;" />');jQuery("#nhs_mapwrap").append('<div id="nhs_OverlayMap" style="position: absolute;z-index:99999;top: 0px;left: 0px;height:100%;width:100%;background-color: #000;filter: alpha(opacity=35);-moz-opacity: 0.35;opacity: 0.35;"></div>');jQuery("#nhs_mapwrap").append('<div id="nhs_LoadingMap" class="nhs_Loading" style="position:absolute;"><p>Updating</p></div>');a.showLoading()},hideLoading:function(){jQuery("#nhs_LoadingMap, #nhs_OverlayMap").hide();jQuery(".gm-style > div > a").attr("href")&&setTimeout(function(){for(var b=jQuery(".gm-style-cc").length,a=1;a<b;a+=1)jQuery(".gm-style-cc").eq("-1").remove();jQuery(".gm-style > div > a").removeAttr("href").removeAttr("title")},800)},showLoading:function(){jQuery("#nhs_LoadingMap, #nhs_OverlayMap").show()},clearOverlays:function(){for(var a=this,b=0;b<a.markersArray.length;b++)a.markersArray[b].setMap(null);a.markersArray=[];a.bounds=new google.maps.LatLngBounds;a.markerCluster&&a.markerCluster.clearMarkers();a.options.Events.OnMarkersRemove()},getMarkerPointAsyn:function(){var a=this,b=a.options.MarkerPointAsynOptions;if(b.Listener&&b.UrlServer){a.options.Events.OnGetMarkerPointAsyn(b);google.maps.event.addListener(a.map,b.Listener,function(){a.showLoading();var c=a.getBoundsFromMap();a.map.clearOverlays();jQuery.getJSON(b.UrlServer,c,function(b){a.processResult(b)})})}else a.hideLoading()},getBoundsFromMap:function(){var e=this,a=e.map.getBounds(),b=a.getNorthEast(),c=a.getSouthWest(),d={minLat:c.lat(),minLng:c.lng(),maxLat:b.lat(),maxLng:b.lng()};return d},processResult:function(a){var c=this;c.showLoading();var d=c.options.ProcessResultOptions;if(a!==null)for(var b=0;b<a.length;b++){var e=c.getHtmlInfowindow(a,a[b]),f=c.getIconMarkerPoint(a,a[b]),g=c.getNameMarkerPoint(a,a[b]);c.createMarkerPoint(a[b][d.Latitude],a[b][d.Longitude],g,e,f,a[b])}c.hideLoading()},getHtmlInfowindow:function(){return null},getIconMarkerPoint:function(){return null},getNameMarkerPoint:function(d,b){var c=this,a=c.options.ProcessResultOptions;return b[a.Name]},createMarkerPoint:function(g,h,f,c,d,e){var a=this,b=a._createMarkerPoint(g,h,f,c,d,e);if(a.options.UseClusterer==false)b.setMap(a.map);else a.markerCluster&&a.markerCluster.addMarker(b);a.markersArray.push(b)},_createMarkerPoint:function(j,k,i,d,h,c){var a=this,e=new google.maps.LatLng(j,k),f=a.options.MarkerPointOptions,g={position:e,icon:h,title:i,optimized:f.optimized,zIndex:99};a.bounds.extend(e);var b=new google.maps.Marker(g);jQuery.isFunction(a.options.Events.OnMarkersCreate)&&a.options.Events.OnMarkersCreate(c,a.infowindow,b);typeof d=="string"&&google.maps.event.addListener(b,"click",function(){a.infowindow.setContent(d);a.infowindow.open(a.map,b);jQuery.isFunction(a.options.Events.MarkerClickCallBack)&&a.options.Events.MarkerClickCallBack.call(a,c,a.infowindow,a.infowindowTooltip,b)});typeof d!="string"&&jQuery.isFunction(a.options.Events.MarkerClickCallBack)&&google.maps.event.addListener(b,"click",function(){a.options.Events.MarkerClickCallBack.call(a,c,a.infowindow,a.infowindowTooltip,b)});jQuery.isFunction(a.options.Events.MarkerMouseOverCallBack)&&google.maps.event.addListener(b,"mouseover",function(){a.options.Events.MarkerMouseOverCallBack.call(a,c,a.infowindow,a.infowindowTooltip,b)});jQuery.isFunction(a.options.Events.MarkerMouseOutCallBack)&&google.maps.event.addListener(b,"mouseout",function(){a.options.Events.MarkerMouseOutCallBack.call(a,c,a.infowindow,a.infowindowTooltip,b)});return b},AutoFit:function(){var a=this;a.map.fitBounds(a.bounds)},CreateOverlay:function(){this.ourOverlay=new google.maps.OverlayView;this.ourOverlay.draw=function(){};this.ourOverlay.setMap(this.map)},GetInfowindowOffset:function(b,f,g,h){var d=0,e=0,a=this.ourOverlay.getProjection().fromLatLngToContainerPixel(h.getPosition()),i=this.ourOverlay.getProjection().fromLatLngToContainerPixel(g.getBounds().getSouthWest()),c=this.ourOverlay.getProjection().fromLatLngToContainerPixel(g.getBounds().getNorthEast());if(a.x<b/2)d=b/2-a.x;else if(a.x>c.x-b/2)d=c.x-b/2-a.x;if(a.y<f)e=a.y+f-(a.y-c.y);else e=a.y+20-(a.y-c.y);return new google.maps.Size(d,e)},GetPixelFromLatLng:function(b){var a=this.map.getProjection(),c=a.fromLatLngToPoint(b);return c},RemoveGoogleInfo:function(){if(jQuery(".gm-style > div > a").attr("href")){for(var b=jQuery(".gm-style-cc").length,a=1;a<b;a+=1)jQuery(".gm-style-cc").eq("-1").remove();jQuery(".gm-style > div > a").removeAttr("href").removeAttr("title")}}};function MarkerClusterer(d,c,e){this.extend(MarkerClusterer,google.maps.OverlayView);this.map_=d;this.markers_=[];this.clusters_=[];this.sizes=[53,56,66,78,90];this.styles_=[];this.ready_=false;var a=e||{};this.gridSize_=a["gridSize"]||60;this.minClusterSize_=a["minimumClusterSize"]||2;this.maxZoom_=a["maxZoom"]||null;this.styles_=a["styles"]||[];this.imagePath_=a["imagePath"]||a["imagePath"]==""?a["imagePath"]:this.MARKER_CLUSTER_IMAGE_PATH_;this.cssName_=a["cssName"]||this.MARKER_CLUSTER_CSS_Name_;this.imageExtension_=a["imageExtension"]||this.MARKER_CLUSTER_IMAGE_EXTENSION_;this.zoomOnClick_=true;if(a["zoomOnClick"]!=undefined)this.zoomOnClick_=a["zoomOnClick"];this.averageCenter_=false;if(a["averageCenter"]!=undefined)this.averageCenter_=a["averageCenter"];this.setupStyles_();this.setMap(d);this.prevZoom_=this.map_.getZoom();var b=this;google.maps.event.addListener(this.map_,"zoom_changed",function(){var a=b.map_.getZoom(),d=b.map_.minZoom||0,c=Math.min(b.map_.maxZoom||100,b.map_.mapTypes[b.map_.getMapTypeId()].maxZoom);a=Math.min(Math.max(a,d),c);if(b.prevZoom_!=a){b.prevZoom_=a;b.resetViewport()}});google.maps.event.addListener(this.map_,"idle",function(){b.redraw()});c&&(c.length||Object.keys(c).length)&&this.addMarkers(c,false)}MarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_PATH_="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m";MarkerClusterer.prototype.MARKER_CLUSTER_CSS_Name_="";MarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_EXTENSION_="png";MarkerClusterer.prototype.extend=function(a,b){return function(b){for(var a in b.prototype)this.prototype[a]=b.prototype[a];return this}.apply(a,[b])};MarkerClusterer.prototype.onAdd=function(){this.setReady_(true)};MarkerClusterer.prototype.draw=function(){};MarkerClusterer.prototype.setupStyles_=function(){if(this.styles_.length)return;for(var a=0,c;c=this.sizes[a];a++){var b={url:"",height:c,width:c,css:""};if(this.imagePath_)b.url=this.imagePath_+(a+1)+"."+this.imageExtension_;if(this.cssName_)b.css=this.cssName_+(a+1);this.styles_.push(b)}};MarkerClusterer.prototype.fitMapToMarkers=function(){for(var d=this.getMarkers(),a=new google.maps.LatLngBounds,c=0,b;b=d[c];c++)a.extend(b.getPosition());this.map_.fitBounds(a)};MarkerClusterer.prototype.setStyles=function(a){this.styles_=a};MarkerClusterer.prototype.getStyles=function(){return this.styles_};MarkerClusterer.prototype.isZoomOnClick=function(){return this.zoomOnClick_};MarkerClusterer.prototype.isAverageCenter=function(){return this.averageCenter_};MarkerClusterer.prototype.getMarkers=function(){return this.markers_};MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_.length};MarkerClusterer.prototype.setMaxZoom=function(a){this.maxZoom_=a};MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_};MarkerClusterer.prototype.calculator_=function(e,d){var a=0,c=e.length,b=c;while(b!==0){b=parseInt(b/10,10);a++}a=Math.min(a,d);return {text:c,index:a}};MarkerClusterer.prototype.setCalculator=function(a){this.calculator_=a};MarkerClusterer.prototype.getCalculator=function(){return this.calculator_};MarkerClusterer.prototype.addMarkers=function(a,d){if(a.length)for(var c=0,b;b=a[c];c++)this.pushMarkerTo_(b);else if(Object.keys(a).length)for(var b in a)this.pushMarkerTo_(a[b]);!d&&this.redraw()};MarkerClusterer.prototype.pushMarkerTo_=function(a){a.isAdded=false;if(a["draggable"]){var b=this;google.maps.event.addListener(a,"dragend",function(){a.isAdded=false;b.repaint()})}this.markers_.push(a)};MarkerClusterer.prototype.addMarker=function(b,a){this.pushMarkerTo_(b);!a&&this.redraw()};MarkerClusterer.prototype.removeMarker_=function(b){var a=-1;if(this.markers_.indexOf)a=this.markers_.indexOf(b);else for(var c=0,d;d=this.markers_[c];c++)if(d==b){a=c;break}if(a==-1)return false;b.setMap(null);this.markers_.splice(a,1);return true};MarkerClusterer.prototype.removeMarker=function(c,a){var b=this.removeMarker_(c);if(!a&&b){this.resetViewport();this.redraw();return true}else return false};MarkerClusterer.prototype.removeMarkers=function(e,d){for(var a=false,c=0,b;b=e[c];c++){var f=this.removeMarker_(b);a=a||f}if(!d&&a){this.resetViewport();this.redraw();return true}};MarkerClusterer.prototype.setReady_=function(a){if(!this.ready_){this.ready_=a;this.createClusters_()}};MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length};MarkerClusterer.prototype.getMap=function(){return this.map_};MarkerClusterer.prototype.setMap=function(a){this.map_=a};MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_};MarkerClusterer.prototype.setGridSize=function(a){this.gridSize_=a};MarkerClusterer.prototype.getMinClusterSize=function(){return this.minClusterSize_};MarkerClusterer.prototype.setMinClusterSize=function(a){this.minClusterSize_=a};MarkerClusterer.prototype.getExtendedBounds=function(a){var b=this.getProjection(),h=new google.maps.LatLng(a.getNorthEast().lat(),a.getNorthEast().lng()),e=new google.maps.LatLng(a.getSouthWest().lat(),a.getSouthWest().lng()),d=b.fromLatLngToDivPixel(h);d.x+=this.gridSize_;d.y-=this.gridSize_;var c=b.fromLatLngToDivPixel(e);c.x-=this.gridSize_;c.y+=this.gridSize_;var f=b.fromDivPixelToLatLng(d),g=b.fromDivPixelToLatLng(c);a.extend(f);a.extend(g);return a};MarkerClusterer.prototype.isMarkerInBounds_=function(b,a){return a.contains(b.getPosition())};MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport(true);this.markers_=[]};MarkerClusterer.prototype.resetViewport=function(d){for(var a=0,c;c=this.clusters_[a];a++)c.remove();for(var a=0,b;b=this.markers_[a];a++){b.isAdded=false;d&&b.setMap(null)}this.clusters_=[]};MarkerClusterer.prototype.repaint=function(){var a=this.clusters_.slice();this.clusters_.length=0;this.resetViewport();this.redraw();window.setTimeout(function(){for(var c=0,b;b=a[c];c++)b.remove()},0)};MarkerClusterer.prototype.redraw=function(){this.createClusters_()};MarkerClusterer.prototype.distanceBetweenPoints_=function(a,b){if(!a||!b)return 0;var h=6371,c=(b.lat()-a.lat())*Math.PI/180,d=(b.lng()-a.lng())*Math.PI/180,e=Math.sin(c/2)*Math.sin(c/2)+Math.cos(a.lat()*Math.PI/180)*Math.cos(b.lat()*Math.PI/180)*Math.sin(d/2)*Math.sin(d/2),f=2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e)),g=h*f;return g};MarkerClusterer.prototype.addToClosestCluster_=function(b){for(var d=4e4,c=null,h=b.getPosition(),g=0,a;a=this.clusters_[g];g++){var e=a.getCenter();if(e){var f=this.distanceBetweenPoints_(e,b.getPosition());if(f<d){d=f;c=a}}}if(c&&c.isMarkerInClusterBounds(b))c.addMarker(b);else{var a=new Cluster(this);a.addMarker(b);this.clusters_.push(a)}};MarkerClusterer.prototype.createClusters_=function(){if(!this.ready_)return;for(var c=new google.maps.LatLngBounds(this.map_.getBounds().getSouthWest(),this.map_.getBounds().getNorthEast()),d=this.getExtendedBounds(c),b=0,a;a=this.markers_[b];b++)!a.isAdded&&this.isMarkerInBounds_(a,d)&&this.addToClosestCluster_(a)};function Cluster(a){this.markerClusterer_=a;this.map_=a.getMap();this.gridSize_=a.getGridSize();this.minClusterSize_=a.getMinClusterSize();this.averageCenter_=a.isAverageCenter();this.center_=null;this.markers_=[];this.bounds_=null;this.clusterIcon_=new ClusterIcon(this,a.getStyles(),a.getGridSize())}Cluster.prototype.isMarkerAlreadyAdded=function(a){if(this.markers_.indexOf)return this.markers_.indexOf(a)!=-1;else for(var b=0,c;c=this.markers_[b];b++)if(c==a)return true;return false};Cluster.prototype.addMarker=function(a){if(this.isMarkerAlreadyAdded(a))return false;if(!this.center_){this.center_=a.getPosition();this.calculateBounds_()}else if(this.averageCenter_){var c=this.markers_.length+1,e=(this.center_.lat()*(c-1)+a.getPosition().lat())/c,f=(this.center_.lng()*(c-1)+a.getPosition().lng())/c;this.center_=new google.maps.LatLng(e,f);this.calculateBounds_()}a.isAdded=true;this.markers_.push(a);var b=this.markers_.length;b<this.minClusterSize_&&a.getMap()!=this.map_&&a.setMap(this.map_);if(b==this.minClusterSize_)for(var d=0;d<b;d++)this.markers_[d].setMap(null);b>=this.minClusterSize_&&a.setMap(null);this.updateIcon();return true};Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_};Cluster.prototype.getBounds=function(){for(var a=new google.maps.LatLngBounds(this.center_,this.center_),d=this.getMarkers(),c=0,b;b=d[c];c++)a.extend(b.getPosition());return a};Cluster.prototype.remove=function(){this.clusterIcon_.remove();this.markers_.length=0;delete this.markers_};Cluster.prototype.getSize=function(){return this.markers_.length};Cluster.prototype.getMarkers=function(){return this.markers_};Cluster.prototype.getCenter=function(){return this.center_};Cluster.prototype.calculateBounds_=function(){var a=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(a)};Cluster.prototype.isMarkerInClusterBounds=function(a){return this.bounds_.contains(a.getPosition())};Cluster.prototype.getMap=function(){return this.map_};Cluster.prototype.updateIcon=function(){var f=this.map_.getZoom(),b=this.markerClusterer_.getMaxZoom();if(b&&f>b){for(var c=0,a;a=this.markers_[c];c++)a.setMap(this.map_);return}if(this.markers_.length<this.minClusterSize_){this.clusterIcon_.hide();return}var d=this.markerClusterer_.getStyles().length,e=this.markerClusterer_.getCalculator()(this.markers_,d);this.clusterIcon_.setCenter(this.center_);this.clusterIcon_.setSums(e);this.clusterIcon_.show()};function ClusterIcon(a,c,b){a.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView);this.styles_=c;this.padding_=b||0;this.cluster_=a;this.center_=null;this.map_=a.getMap();this.div_=null;this.sums_=null;this.visible_=false;this.setMap(this.map_)}ClusterIcon.prototype.triggerClusterClick=function(){var a=this.cluster_.getMarkerClusterer();google.maps.event.trigger(a,"clusterclick",this.cluster_);a.isZoomOnClick()&&this.map_.fitBounds(this.cluster_.getBounds());jQuery.googlepush("Search Events","Search Results - Map","Map - Cluster Click")};ClusterIcon.prototype.onAdd=function(){this.div_=document.createElement("DIV");if(this.visible_){var c=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(c);this.div_.innerHTML=this.sums_.text;this.div_.className=this.css_}var a=this.getPanes();a.overlayMouseTarget.appendChild(this.div_);var b=this;google.maps.event.addDomListener(this.div_,"click",function(){b.triggerClusterClick()})};ClusterIcon.prototype.getPosFromLatLng_=function(b){var a=this.getProjection().fromLatLngToDivPixel(b);a.x-=parseInt(this.width_/2,10);a.y-=parseInt(this.height_/2,10);return a};ClusterIcon.prototype.draw=function(){if(this.visible_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.top=a.y+"px";this.div_.style.left=a.x+"px"}};ClusterIcon.prototype.hide=function(){if(this.div_)this.div_.style.display="none";this.visible_=false};ClusterIcon.prototype.show=function(){if(this.div_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(a);this.div_.style.display=""}this.visible_=true};ClusterIcon.prototype.remove=function(){this.setMap(null)};ClusterIcon.prototype.onRemove=function(){if(this.div_&&this.div_.parentNode){this.hide();this.div_.parentNode.removeChild(this.div_);this.div_=null}};ClusterIcon.prototype.setSums=function(a){this.sums_=a;this.text_=a.text;this.index_=a.index;if(this.div_)this.div_.innerHTML=a.text;this.useStyle()};ClusterIcon.prototype.useStyle=function(){var b=Math.max(0,this.sums_.index-1);b=Math.min(this.styles_.length-1,b);var a=this.styles_[b];this.url_=a["url"];this.css_=a["css"];this.height_=a["height"];this.width_=a["width"];this.textColor_=a["textColor"];this.anchor_=a["anchor"];this.textSize_=a["textSize"];this.backgroundPosition_=a["backgroundPosition"]};ClusterIcon.prototype.setCenter=function(a){this.center_=a};ClusterIcon.prototype.createCss=function(b){var a=[];this.url_&&a.push("background-image:url("+this.url_+");");var c=this.backgroundPosition_?this.backgroundPosition_:"0 0";a.push("background-position:"+c+";");if(typeof this.anchor_==="object"){if(typeof this.anchor_[0]==="number"&&this.anchor_[0]>0&&this.anchor_[0]<this.height_)a.push("height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;");else a.push("height:"+this.height_+"px; line-height:"+this.height_+"px;");if(typeof this.anchor_[1]==="number"&&this.anchor_[1]>0&&this.anchor_[1]<this.width_)a.push("width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;");else a.push("width:"+this.width_+"px; text-align:center;")}else a.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;");var d=this.textColor_?this.textColor_:"black",e=this.textSize_?this.textSize_:11;a.push("cursor:pointer; top:"+b.y+"px; left:"+b.x+"px; color:"+d+"; position:absolute; font-size:"+e+"px; font-family:Arial,sans-serif; font-weight:bold");return a.join("")};window["MarkerClusterer"]=MarkerClusterer;MarkerClusterer.prototype["addMarker"]=MarkerClusterer.prototype.addMarker;MarkerClusterer.prototype["addMarkers"]=MarkerClusterer.prototype.addMarkers;MarkerClusterer.prototype["clearMarkers"]=MarkerClusterer.prototype.clearMarkers;MarkerClusterer.prototype["fitMapToMarkers"]=MarkerClusterer.prototype.fitMapToMarkers;MarkerClusterer.prototype["getCalculator"]=MarkerClusterer.prototype.getCalculator;MarkerClusterer.prototype["getGridSize"]=MarkerClusterer.prototype.getGridSize;MarkerClusterer.prototype["getExtendedBounds"]=MarkerClusterer.prototype.getExtendedBounds;MarkerClusterer.prototype["getMap"]=MarkerClusterer.prototype.getMap;MarkerClusterer.prototype["getMarkers"]=MarkerClusterer.prototype.getMarkers;MarkerClusterer.prototype["getMaxZoom"]=MarkerClusterer.prototype.getMaxZoom;MarkerClusterer.prototype["getStyles"]=MarkerClusterer.prototype.getStyles;MarkerClusterer.prototype["getTotalClusters"]=MarkerClusterer.prototype.getTotalClusters;MarkerClusterer.prototype["getTotalMarkers"]=MarkerClusterer.prototype.getTotalMarkers;MarkerClusterer.prototype["redraw"]=MarkerClusterer.prototype.redraw;MarkerClusterer.prototype["removeMarker"]=MarkerClusterer.prototype.removeMarker;MarkerClusterer.prototype["removeMarkers"]=MarkerClusterer.prototype.removeMarkers;MarkerClusterer.prototype["resetViewport"]=MarkerClusterer.prototype.resetViewport;MarkerClusterer.prototype["repaint"]=MarkerClusterer.prototype.repaint;MarkerClusterer.prototype["setCalculator"]=MarkerClusterer.prototype.setCalculator;MarkerClusterer.prototype["setGridSize"]=MarkerClusterer.prototype.setGridSize;MarkerClusterer.prototype["setMaxZoom"]=MarkerClusterer.prototype.setMaxZoom;MarkerClusterer.prototype["onAdd"]=MarkerClusterer.prototype.onAdd;MarkerClusterer.prototype["draw"]=MarkerClusterer.prototype.draw;Cluster.prototype["getCenter"]=Cluster.prototype.getCenter;Cluster.prototype["getSize"]=Cluster.prototype.getSize;Cluster.prototype["getMarkers"]=Cluster.prototype.getMarkers;ClusterIcon.prototype["onAdd"]=ClusterIcon.prototype.onAdd;ClusterIcon.prototype["draw"]=ClusterIcon.prototype.draw;ClusterIcon.prototype["onRemove"]=ClusterIcon.prototype.onRemove;Object.keys=Object.keys||function(c){var a=[];for(var b in c)c.hasOwnProperty(b)&&a.push(b);return a};NHS.Scripts.CommunityResults.Facets=function(a){this._locationControlId=a.locationControlId;this._autoCompleteAction=a.autoCompleteAction;this._locationSliderControlId=a.locationSliderControlId;this._locationSliderTextId=a.locationSliderTextId;this._locationButtonControlId=a.locationButtonControlId;this._intervalId=0;this._pageSize=a.pageSize;this._priceLow=1;this._priceHigh=28;this._sqFtLow=0;this._sqFtHigh=20;this._priceSliderControlId=a.priceSliderControlId;this._priceSliderTextFromId=a.priceSliderTextFromId;this._priceSliderTextToId=a.priceSliderTextToId;this._sqFtSliderControlId=a.sqFtSliderControlId;this._sqFtSliderTextFromId=a.sqFtSliderTextFromId;this._sqFtSliderTextToId=a.sqFtSliderTextToId;this._facetModalAmenities=a.facetModalAmenities;this._facetModalSchools=a.facetModalSchools;this._facetModalStatus=a.facetModalStatus;this._facetModalBedrooms=a.facetModalBedrooms;this._facetModalBathrooms=a.facetModalBathrooms;this._facetModalVideo=a.facetModalVideo;this._facetModalEvent=a.facetModalEvent;this._facetModalPromotions=a.facetModalPromotions;this._facetLinkBuilder=a.facetLinkBuilder;this._facetModalBuilder=a.facetModalBuilder;this._facetModalCities=a.facetModalCities;this._searchParameters=a.searchParameters;var c="Under $100K",b="$1.0M & Up";if(this._searchParameters.PartnerId==333)c="No Minimum";if(this._searchParameters.PartnerId==333)b="No Maximum";var e="Under 600",d="10,000 & Up";this._originalTop=0;this._adsBottom=0;this._adsHeight=0;this._priceSliderText=[c,"$110,000","$120,000","$130,000","$140,000","$150,000","$160,000","$170,000","$180,000","$190,000","$200,000","$220,000","$240,000","$260,000","$280,000","$300,000","$325,000","$350,000","$375,000","$400,000","$425,000","$450,000","$475,000","$500,000","$600,000","$700,000","$800,000","$900,000",b];this._priceSliderValues=["100000","110000","120000","130000","140000","150000","160000","170000","180000","190000","200000","220000","240000","260000","280000","300000","325000","350000","375000","400000","425000","450000","475000","500000","600000","700000","800000","900000","1000000"];this._sqFtSliderText=[e,"1,000","1,500","2,000","2,500","3,000","3,500","4,000","4,500","5,000","5,500","6,000","6,500","7,000","7,500","8,000","8,500","9,000","9,500",d];this._sqFtSliderValues=["600","1000","1500","2000","2500","3000","3500","4000","4500","5000","5500","6000","6500","7000","7500","8000","8500","9000","9500","10000"];this._locationSliderText=["Exact Location","1 Mile from center","3 Miles from center","5 Miles from center","10 Miles from center","15 Miles from center","25 Miles from center"];this._locationSliderValues=["0","1","3","5","10","15","25"];this._commResults=a.commResults;this._log=this._commResults.get_log();this.validateSearchTextFunction=a.validateSearchTextFunction};NHS.Scripts.CommunityResults.Facets.prototype={set_searchParameters:function(a){this._searchParameters=a},get_log:function(){return this._log},initialize:function(){var a=this;$jq("#LocationName").keypress(function(a){var b=a.keyCode?a.keyCode:a.which;b=="13"&&$jq("#btnGo").click()});$jq("#"+this._locationButtonControlId).click(function(){a._searchParameters.SchoolDistrictId=0;var b=false;if(this._locationButtonControlId=="btnGo"){this._resetFacets();b=true}var c=$jq("#"+this._locationControlId).val();if(!a.validateSearchTextFunction(c)){$jq.googlepush("Search Events","Search Action","Search - Location");$jq.ajax({url:this._commResults.get_SearchAction(),type:"POST",data:{searchParameters:NHS.Scripts.Helper.JSON.toString(this._searchParameters),searchLocation:$jq("#"+this._locationControlId).val(),page:1,pageSize:this._pageSize,isLocationSearchBox:b,locationType:$jq("#LocationType").val()},success:function(a){if(a.indexOf("locationhandler")!=-1)window.location=a;else{$jq("#nhs_Facets").html(a);$jq(document).ready(function(){this.initialize()}.bind(this))}}.bind(this),error:function(c,b,a){NHS.Scripts.Helper.logError(a,this._searchAction,"error on search");this.hideProgressIndicator()}.bind(this)})}else alert("Please enter a valid location or select an item from the list.")}.bind(this));$jq(".nhs_FacetMenuBox").hover(function(){$jq(this).addClass("hover")},function(){$jq(this).removeClass("hover")});$jq(".nhs_FacetModalClose").click(function(){a._closeFacetMenu()});$jq(".nhs_FacetGroupTitle span,  #nhs_FacetLinkCities").hover(function(){a._closeFacetMenu();clearInterval(a._intervalId);$jq(this).addClass("nhs_FacetLinkOpen");$jq($jq(this).parent().parent().find(".nhs_FacetMenuBox")[0]).show("Fold");return false},function(){var b=$jq($jq(this).parent().parent().find(".nhs_FacetMenuBox")[0]);a._intervalId=setInterval(function(){if(!$jq(b).is(".hover")&&!$jq(this).is(".nhs_Hover")){a._closeFacetMenu();clearInterval(a._intervalId)}},300)});$jq("#"+this._facetLinkBuilder).click(function(){$jq("#"+this._facetModalBuilder).toggle("fast",function(){this._setColHeight()}.bind(this));if($jq("#"+this._facetLinkBuilder).html().indexOf("All")>=0)$jq("#"+this._facetLinkBuilder).html("< Hide builder list");else $jq("#"+this._facetLinkBuilder).html("All area builders >");return false}.bind(this));$jq("#"+this._facetModalAmenities+" ul li a, #nhs_FacetTypeAmenities .nhs_FacetRemove").click(function(){if($jq(this).is(".nhs_FacetRemove")&&$jq(this).is(".type"))a._searchParameters.HomeType="";else if($jq(this).is(".amenity")&&$jq(this).is(".nhs_FacetRemove")){if($jq(this).attr("rel")=="pool"||$jq(this).attr("rel")=="")a._searchParameters.Pool=false;if($jq(this).attr("rel")=="gated"||$jq(this).attr("rel")=="")a._searchParameters.Gated=false;if($jq(this).attr("rel")=="green"||$jq(this).attr("rel")=="")a._searchParameters.GreenProgram=false;if($jq(this).attr("rel")=="golf"||$jq(this).attr("rel")=="")a._searchParameters.GolfCourse=false}else if($jq(this).is(".nhs_Facet")){var b="";$jq.googlepush("Search Events","Search Refinement","Type/Amenities");if($jq(this).is(".type")){a._searchParameters.HomeType=$jq(this).attr("rel");b=a._searchParameters.HomeType=="SF"?"FAHTSF":"FAHTCT"}else if($jq(this).is(".amenity")&&$jq(this).attr("rel")=="green"){a._searchParameters.GreenProgram=true;b="FAAMGRN"}else if($jq(this).is(".amenity")&&$jq(this).attr("rel")=="pool"){a._searchParameters.Pool=true;b="FAAMP"}else if($jq(this).is(".amenity")&&$jq(this).attr("rel")=="golf"){a._searchParameters.GolfCourse=true;b="FAAMGO"}else if($jq(this).is(".amenity")&&$jq(this).attr("rel")=="gated"){a._searchParameters.Gated=true;b="FAAMGA"}a.get_log().logEvent(b,0,0)}a._updateResults();return false});$jq("#"+this._facetModalBuilder+" a.nhs_BoylLink, #nhs_BuilderPromoBrands a.nhs_BoylLink").each(function(c,b){$jq(b).attr("temp",$jq(b).attr("href"));$jq(b).attr("href","#");$jq(b).click(function(){a.get_log().logEvent("CRBR",0,$jq(this).attr("rel"));url=$jq(this).attr("temp");setTimeout(function(){$jq(location).attr("href",url)},1e3)})});$jq("#"+this._facetModalBuilder+" ul li a.nhs_Facet, #nhs_BuilderPromoBrands a.nhs_LogoFacet, #nhs_FacetBuilderDisplay .nhs_FacetRemove").click(function(){if(!$jq(this).find("img")[0])brandId=$jq(this).attr("rel");else brandId=$jq($jq(this).find("img")[0]).attr("rel");a._searchParameters.BrandId=brandId;a._updateResults();return false});$jq("#"+this._facetModalStatus+" ul li a, #nhs_FacetStatus .nhs_FacetRemove").click(function(){if($jq(this).is(".nhs_Facet")||$jq(this).is(".nhs_FacetRemove")){a._searchParameters.CommunityStatus=$jq(this).attr("rel");a._searchParameters.CommunityStatus!=""&&$jq.googlepush("Search Events","Search Refinement","Community Stage");a._updateResults()}return false});$jq("#"+this._facetModalBedrooms+" ul li a, #nhs_FacetBedrooms .nhs_FacetRemove").click(function(){if($jq(this).is(".nhs_Facet")||$jq(this).is(".nhs_FacetRemove")){a._searchParameters.NumOfBeds=$jq(this).attr("rel");a._searchParameters.NumOfBeds>0&&$jq.googlepush("Search Events","Search Refinement","Bedrooms");a._updateResults();a.get_log().logEvent("FAHS"+a._searchParameters.NumOfBeds,0,0)}return false});$jq("#"+this._facetModalBathrooms+" ul li a, #nhs_FacetBathrooms .nhs_FacetRemove").click(function(){if($jq(this).is(".nhs_Facet")||$jq(this).is(".nhs_FacetRemove")){a._searchParameters.NumOfBaths=$jq(this).attr("rel");a._searchParameters.NumOfBaths>0&&$jq.googlepush("Search Events","Search Refinement","Bathrooms");a._updateResults();a.get_log().logEvent("FAHB"+a._searchParameters.NumOfBaths,0,0)}return false});$jq("#"+this._facetModalVideo+" ul li a, #nhs_FacetVideo .nhs_FacetRemove").click(function(){if($jq(this).is(".nhs_Facet")||$jq(this).is(".nhs_FacetRemove")){a._searchParameters.HasVideo=$jq(this).attr("rel")==""?false:true;a._searchParameters.HasVideo&&$jq.googlepush("Search Events","Search Refinement","Video Available");a._updateResults();a.get_log().logEvent("CRVDCT",0,0)}return false});$jq("#"+this._facetModalEvent+" ul li a, #nhs_FacetEvents .nhs_FacetRemove").click(function(){if($jq(this).is(".nhs_Facet")||$jq(this).is(".nhs_FacetRemove")){a._searchParameters.HasEvent=$jq(this).attr("rel")==""?false:true;a._searchParameters.HasEvent&&$jq.googlepush("Search Events","Search Refinement","Event Available");a._updateResults();a.get_log().logEvent("CREVCT",0,0)}return false});$jq("#"+this._facetModalPromotions+" ul li a, #nhs_FacetPromotions .nhs_FacetRemove").click(function(){if($jq(this).is(".nhs_Facet")||$jq(this).is(".nhs_FacetRemove")){a._searchParameters.PromotionType=$jq(this).attr("rel")==""?0:$jq(this).attr("rel");a._searchParameters.PromotionType>0&&$jq.googlepush("Search Events","Search Refinement","Promotion Available");a._updateResults();a.get_log().logEvent("FAPRM",0,0)}return false});$jq("#"+this._facetModalSchools+" ul li a, #nhs_FacetSchools .nhs_FacetRemove").click(function(){if($jq(this).is(".nhs_Facet")||$jq(this).is(".nhs_FacetRemove")){a._searchParameters.SchoolDistrictId=$jq(this).attr("rel");a._searchParameters.SchoolDistrictId>0&&$jq.googlepush("Search Events","Search Refinement","Schools");a._updateResults();a.get_log().logEvent("FASCH",0,0)}return false});$jq("#"+this._facetModalCities+" ul li a, #nhs_FacetLocation .nhs_FacetRemove").click(function(){if($jq(this).is(".nhs_Facet")||$jq(this).is(".nhs_FacetRemove")){if($jq(this).attr("rel")=="latlong"){a._searchParameters.MinLatitude=0;a._searchParameters.MinLongitude=0;a._searchParameters.MaxLatitude=0;a._searchParameters.MaxLongitude=0;a._commResults.restoreSearchState();a._commResults.resetSearchArea()}else if($jq(this).attr("rel")!=""&&$jq(this).attr("rel")!="0"){a._searchParameters.CityNameFilter=$jq(this).attr("rel").split(",")[0];a._searchParameters.State=$jq(this).attr("rel").split(",")[1];a._searchParameters.SortOrder=10;$jq.googlepush("Search Events","Search Refinement","Related Area")}else{a._searchParameters.City="";a._searchParameters.State="";a._searchParameters.CityNameFilter="";a._searchParameters.Radius=0;a._searchParameters.SortOrder=0}a._citiChanged=true;a._updateResults()}return false});$jq("a#ComingSoonFacet").click(function(){a.get_log().logEvent("CRGO",0,0);var b=$jq(this).attr("href");setTimeout(function(){$jq(location).attr("href",b)},500);return false});var b=this._locationSliderValues.indexOf(this._searchParameters.Radius==0?this._locationSliderValues[0]:this._searchParameters.Radius.toString());if(b==-1)if(this._searchParameters.Radius>this._locationSliderValues[this._locationSliderValues.length-1])b=this._locationSliderValues[this._locationSliderValues.length-1];else for(i=0;i<this._locationSliderValues.length-1;i++)if(this._searchParameters.Radius>this._locationSliderValues[i]&&this._searchParameters.Radius<this._locationSliderValues[i+1])b=i;$jq("#"+this._locationSliderTextId).text(this._locationSliderText[b]);$jq("#"+this._locationSliderControlId).slider({value:100,min:0,max:6,step:1,value:b,slide:function(b,a){$jq("#"+this._locationSliderTextId).text(this._locationSliderText[a.value])}.bind(this),change:function(b,a){this._searchParameters.Radius=this._locationSliderValues[a.value];$jq.googlepush("Search Events","Search Refinement","Select Distance");if(this._searchParameters.City!="")this._searchParameters.CityNameFilter=this._searchParameters.Radius==0?this._searchParameters.City:"";this._updateResults()}.bind(this)});var d=this._priceSliderValues.indexOf(this._searchParameters.PriceLow==0?this._priceSliderValues[0]:this._searchParameters.PriceLow.toString()),c=this._priceSliderValues.indexOf(this._searchParameters.PriceHigh==0?this._priceSliderValues[this._priceSliderValues.length-1]:this._searchParameters.PriceHigh.toString());$jq("#"+this._priceSliderTextFromId).text(this._priceSliderText[d]);$jq("#"+this._priceSliderTextToId).text(this._priceSliderText[c]);$jq("#"+this._priceSliderControlId).slider({value:100,min:0,max:28,range:true,step:1,values:[d,c],slide:function(b,a){$jq("#"+this._priceSliderTextFromId).text(this._priceSliderText[a.values[0]]);$jq("#"+this._priceSliderTextToId).text(this._priceSliderText[a.values[1]])}.bind(this),change:function(c,b){this._searchParameters.PriceLow=this._priceSliderValues[b.values[0]];this._searchParameters.PriceHigh=this._priceSliderValues[b.values[1]];if(b.values[0]!=this._priceLow){$jq.googlepush("Search Events","Search Refinement","Select Price - Low");this._priceLow=b.values[0]}if(b.values[1]!=this._priceHigh){$jq.googlepush("Search Events","Search Refinement","Select Price - High");this._priceHigh=b.values[1]}this._updateResults();a.get_log().logEvent("FAPRICE",0,0)}.bind(this)});var f=this._sqFtSliderValues.indexOf(this._searchParameters.SqFtLow==0?this._sqFtSliderValues[0]:this._searchParameters.SqFtLow.toString()),e=this._sqFtSliderValues.indexOf(this._searchParameters.SqFtHigh==0?this._sqFtSliderValues[this._sqFtSliderValues.length-1]:this._searchParameters.SqFtHigh.toString());$jq("#"+this._sqFtSliderTextFromId).text(this._sqFtSliderText[f]);$jq("#"+this._sqFtSliderTextToId).text(this._sqFtSliderText[e]);$jq("#"+this._sqFtSliderControlId).slider({value:100,min:0,max:a._sqFtSliderValues.length-1,range:true,step:1,values:[f,e],slide:function(b,a){$jq("#"+this._sqFtSliderTextFromId).text(this._sqFtSliderText[a.values[0]]);$jq("#"+this._sqFtSliderTextToId).text(this._sqFtSliderText[a.values[1]])}.bind(this),change:function(c,b){this._searchParameters.SqFtLow=this._sqFtSliderValues[b.values[0]];this._searchParameters.SqFtHigh=this._sqFtSliderValues[b.values[1]];if(b.values[0]!=this._sqFtLow){$jq.googlepush("Search Events","Search Refinement","Select SqFt - Low");this._sqFtLow=b.values[0]}if(b.values[1]!=this._sqFtHigh){$jq.googlepush("Search Events","Search Refinement","Select SqFt - High");this._sqFtHigh=b.values[1]}this._updateResults();a.get_log().logEvent("FASQFT",0,0)}.bind(this)});searchTypeahead.setupSearchBox("LocationName","LocationType");var g=new NHS.Scripts.Helper.FieldDefaultValue("SearchText","Enter City, State (or Zip code)","fieldDefaultText","btnGo");g.initialize();this._updateAdsPosition()},_resetFacets:function(){this._searchParameters.Radius="0";this._searchParameters.CityNameFilter="";this._searchParameters.PriceLow="100000";this._searchParameters.PriceHigh="1000000";this._searchParameters.CommunityStatus="";this._searchParameters.NumOfBeds="0";this._searchParameters.NumOfBaths=0;this._searchParameters.HasVideo=false;this._searchParameters.SchoolDistrictId=0;this._searchParameters.HomeType="";this._searchParameters.Pool=false;this._searchParameters.GreenNatureAreas=false;this._searchParameters.GreenProgram=false;this._searchParameters.GolfCourse=false;this._searchParameters.Gated=false;this._searchParameters.Parks=false;this._searchParameters.Adult=false;this._commResults.set_searchParameters(this._searchParameters)},_updateResults:function(){this._closeFacetMenu();this._closeBuilderMenu();this._commResults.set_searchParameters(this._searchParameters);this._commResults.update();this._updateAdsPosition()},_updateAdsPosition:function(){$jq("#nhs_Mediatitle").text("Community video gallery");if($jq("#nhs_CommResRightAds").length>0){var a=$jq("#nhs_CommResMapListCol").height();this._adsHeight=$jq("#nhs_CommResRightAds").height();var b=$jq("#nhs_RightTopSky,#nhs_RightTopSky2").height();this._originalTop=$jq("#nhs_CommResRightAds").offset().top-parseFloat($jq("#nhs_CommResRightAds").css("marginTop").replace(/auto/,0));var e=$jq("#nhs_RightTopSky,#nhs_RightTopSky2").offset().top-parseFloat($jq("#nhs_RightTopSky,#nhs_RightTopSky2").css("marginTop").replace(/auto/,0)),f=a+$jq("#nhs_CommResMapListCol").offset().top-this._adsHeight,d=a+$jq("#nhs_CommResMapListCol").offset().top-b,h=a-this._adsHeight-10,c=a-b-10;this._adsBottom=this._adsHeight+$jq("#nhs_CommResRightAds").offset().top;var g=b+$jq("#nhs_RightTopSky,#nhs_RightTopSky2").offset().top;$jq(window).scroll(function(){var b=$jq(document).scrollTop();a=$jq("#nhs_CommResMapListCol").height();if(a>this._adsBottom)if(b>=this._originalTop)if(b>f){$jq("#nhs_CommResVideoAds #nhs_CommResRightAds").removeClass("fixed");$jq("#nhs_CommResVideoAds #nhs_CommResRightAds").addClass("absolute");$jq("#nhs_CommResVideoAds #nhs_CommResRightAds").css("top",h+"px")}else{$jq("#nhs_CommResVideoAds #nhs_CommResRightAds").removeClass("absolute");$jq("#nhs_CommResVideoAds #nhs_CommResRightAds").addClass("fixed");$jq("#nhs_CommResVideoAds #nhs_CommResRightAds").css("top",0)}else $jq("#nhs_CommResVideoAds #nhs_CommResRightAds").removeClass("fixed");if(a>g)if(b>=e)if(b>d){if(c>0){$jq("#nhs_CommResFacetCol #nhsAdContainerRight2").removeClass("fixed");$jq("#nhs_CommResFacetCol #nhsAdContainerRight2").addClass("absolute");$jq("#nhs_CommResFacetCol #nhsAdContainerRight2").css("top",c+"px")}}else{$jq("#nhs_CommResFacetCol #nhsAdContainerRight2").removeClass("absolute");$jq("#nhs_CommResFacetCol #nhsAdContainerRight2").addClass("fixed");$jq("#nhs_CommResFacetCol #nhsAdContainerRight2").css("top",0)}else $jq("#nhs_CommResFacetCol #nhsAdContainerRight2").removeClass("fixed")}.bind(this))}},_setColHeight:function(){if($jq("#nhs_CommResRightAds").length>0){this._originalTop=$jq("#nhs_CommResRightAds").offset().top-parseFloat($jq("#nhs_CommResRightAds").css("marginTop").replace(/auto/,0));this._adsBottom=this._adsHeight+$jq("#nhs_CommResRightAds").offset().top}},_closeFacetMenu:function(){$jq(".nhs_FacetMenuBox").hide();$jq(".nhs_FacetLinkOpen").removeClass("nhs_FacetLinkOpen")},_closeBuilderMenu:function(){$jq("#"+this._facetModalBuilder).hide();$jq("#"+this._facetLinkBuilder).html("All area builders >")}};var BCMAPI=new function(){this.token="";this.callback="BCMAPI.flush";this.url="http://api.brightcove.com/services/library";this.calls=[{command:"find_all_videos",def:false},{command:"find_video_by_id",def:"video_id"},{command:"find_video_by_id_unfiltered",def:"video_id"},{command:"find_videos_by_ids",def:"video_ids"},{command:"find_videos_by_ids_unfiltered",def:"video_ids"},{command:"find_video_by_reference_id",def:"reference_id"},{command:"find_video_by_reference_id_unfiltered",def:"reference_id"},{command:"find_videos_by_reference_ids",def:"reference_ids"},{command:"find_videos_by_reference_ids_unfiltered",def:"reference_ids"},{command:"find_videos_by_campaign_id",def:"campaign_id"},{command:"find_videos_by_tags",def:"or_tags"},{command:"find_videos_by_text",def:"text"},{command:"find_videos_by_user_id",def:"user_id"},{command:"find_modified_videos",def:"from_date"},{command:"find_related_videos",def:"video_id"},{command:"find_all_playlists",def:false},{command:"find_playlist_by_id",def:"playlist_id"},{command:"find_playlists_by_ids",def:"playlist_ids"},{command:"find_playlist_by_reference_id",def:"reference_id"},{command:"find_playlists_by_reference_ids",def:"reference_ids"},{command:"find_playlists_for_player_id",def:"player_id"},{command:"search_videos",def:"all"}];this.inject=function(b){var a=document.createElement("script");a.setAttribute("src",this.url+"?"+b);a.setAttribute("type","text/javascript");document.getElementsByTagName("head")[0].appendChild(a);return true};this.find=function(c,a){c=c.toLowerCase().replace(/(find_)|(_)|(get_)/g,"");a=a||null;var f=null,b="";for(var d in this.calls){if(typeof this.calls[d].command=="undefined")continue;if(c==this.calls[d].command.toLowerCase().replace(/(find_)|(_)|(get_)/g,"")){c=this.calls[d].command;if(typeof this.calls[d].def!="undefined")f=this.calls[d].def;break}}b="command="+c;if(typeof a=="object"&&a){for(var e in a)if(e=="selector")b+="&"+f+"="+encodeURIComponent(a[e]);else b+="&"+e+"="+encodeURIComponent(a[e]);if(typeof a.callback!="string")b+="&callback="+this.callback;if(typeof a.token!="string")b+="&token="+this.token}else if(a){b+="&"+f+"="+encodeURIComponent(a)+"&callback="+this.callback;b+="&token="+this.token}else{b+="&token="+this.token;b+="&callback="+this.callback}this.inject(b);return true};this.search=function(a){return this.find("search_videos",a)};this.flush=function(){return true}};var bcExp,bcVP,bcImg,bcVw,_imageBaseUrl,_imgNLinks,_mp_listingType,_bcExperienceID,mp_captionBarID,_videos,_currentObjCache,_globalParams,loadURL,loadSubType,loadTitle,loadIndex,loadCue,loadID,modExp,modCon;NHS.Scripts.MediaPlayerVideo=function(a){if(a.mediaObjs.length==0)mp_mediaItems=null;else mp_mediaItems=a.mediaObjs;_mp_ComID=a.hasOwnProperty("communityID")?a.communityID:0;_mp_PlanID=a.hasOwnProperty("planID")?a.planID:0;_mp_SpecID=a.hasOwnProperty("specID")?a.specID:0;_mp_builderID=a.builderID;_mp_listingType=a.hasOwnProperty("specID")?"spec":a.hasOwnProperty("planID")?"plan":a.hasOwnProperty("communityID")?"com":"commres";this._externalLinks=a.externalLinks;_globalParams=a;_bcExperienceID=a.bcExperienceID;_imgBaseUrl=a.imgBaseUrl;this._titlebarID=a.titleBarID;_mp_listingType=="com"?$jq("#"+this._titlebarID).text("Community Gallery"):$jq("#"+this._titlebarID).text("Home Gallery");mp_captionBarID=a.captionBarID;_mp_imgtitleBar=a.imgtitleBar;_logger=a.logger;this.marketId=a.marketID;this.marketName=a.marketName};onTemplateReady=function(){var a=this.myvidid,b=this.mysubtype,c=this.mytitle,d=this.myindex,e=this.mycue,f=this.myid;NHS.Scripts.MediaPlayerVideo.loadVideo(a,b,c,d,e,f);this.allLoaded=true};myTemplateLoaded=function(a){bcExp=brightcove.api.getExperience(a);bcVP=bcExp.getModule(brightcove.api.modules.APIModules.VIDEO_PLAYER);modExp=bcExp.getModule(brightcove.api.modules.APIModules.EXPERIENCE);modCon=bcExp.getModule(brightcove.api.modules.APIModules.CONTENT);var c=$jq(".BrightcoveExperience").width(),b=$jq(".BrightcoveExperience").height();modExp.setSize(c,b)};NHS.Scripts.MediaPlayerVideo.prototype={_initialize:function(a){BCMAPI.token="HYWld5USmeg7f3O0xaq2UgSaQBVyuw72JRRcM_k4sRX7yIGlb-lcuQ..";BCMAPI.callback=a;_currentObjCache=this},_popImgnLnksFromMediaItems:function(b){_imgNLinks=[];var a=false;if(mp_mediaItems!=null){var c=mp_mediaItems;jQuery.each(c,function(c,b){if(b.Type==="i"){_imgNLinks.push(b);a=true}})}if(_currentObjCache._externalLinks!=null&&_currentObjCache._externalLinks.length>0){var d=_currentObjCache._externalLinks;jQuery.each(d,function(c,b){_imgNLinks.push(b);a=true})}if(!b&&a);!b&&!a&&NHS.Scripts.MediaPlayerVideo._noMedia()},loadShowCasePlayer:function(){$jq("#videoList").empty();this._initialize("NHS.Scripts.MediaPlayerVideo._popShowcaseVideos");var a=NHS.Scripts.MediaPlayerVideo._getTags(),c=a!="",b=this.marketName+"_"+this.marketId;a+=a!==""?",showcasevideo,":"showcasevideo";a=b+",allmarkets-"+_globalParams.brightCoveSuffix+","+a;BCMAPI.find("find_videos_by_tags",{or_tags:a,fields:"name,id,referenceId,thumbnailURL,tags"})},loadMediaPlayer:function(a){if(a=="community")this.loadComDetailsMediaPlayer();else if(a=="home")this.loadHomDetailsMediaPlayer();else a=="results"&&this.loadShowCasePlayer()},loadComDetailsMediaPlayer:function(){this._loadDetailsMediaPlayer("NHS.Scripts.MediaPlayerVideo._popComVideos")},loadHomDetailsMediaPlayer:function(){this._loadDetailsMediaPlayer("NHS.Scripts.MediaPlayerVideo._popHomVideos")},_loadDetailsMediaPlayer:function(b){this._initialize(b);var a=NHS.Scripts.MediaPlayerVideo._getTags(),c=a!="";if(c)BCMAPI.find("find_videos_by_tags",{or_tags:a,fields:"id,referenceId,thumbnailURL,tags"});else this._popImgnLnksFromMediaItems(false)}};NHS.Scripts.MediaPlayerVideo._getTags=function(){var a="";if(mp_mediaItems!=null){jQuery.each(mp_mediaItems,function(c,b){if(b.Type==="v")a+=b.VideoID+","});a=a.substr(0,a.length-1)}return a};NHS.Scripts.MediaPlayerVideo._popComVideos=function(a){NHS.Scripts.MediaPlayerVideo._popVideos(a,"cv")};NHS.Scripts.MediaPlayerVideo._popHomVideos=function(a){NHS.Scripts.MediaPlayerVideo._popVideos(a,"hv")};NHS.Scripts.MediaPlayerVideo._popShowcaseVideos=function(a){NHS.Scripts.MediaPlayerVideo._popVideos(a,"sv")};NHS.Scripts.MediaPlayerVideo._popVideos=function(d,j){_currentObjCache._popImgnLnksFromMediaItems(d.items.length!=0);var a=[],b=[],h=[],m=NHS.Scripts.MediaPlayerVideo.lookUpTable,f=j,c="";jQuery.each(d.items,function(r,e){var j=0,p=0,i=0;if(e.referenceId==null)e.referenceId="";if(e.tags.length>=2){var g=e.tags[1],k=e.tags[0];if(g.indexOf("-")!=-1){var q=k;k=g;g=q}var l=k.split("-");if(l.length>2){j=l[1];i=l[2]}var n=true;mp_mediaItems!=null&&e.tags[0]!="showcasevideo"&&jQuery.each(mp_mediaItems,function(b,a){if(a.RefID==i){n=false;c=a.Title;p=a.Sort*1;return false}})}_videos=d.items;var m=false;a.length>0&&g!=""&&e.tags[0]!="showcasevideo"&&jQuery.each(a,function(b,a){if(g==a.hash){m=true;return false}});if(!m&&!n&&e.tags[0]!="showcasevideo")a[a.length]={Type:"v",SubType:f,Thumbnail:e.thumbnailURL,Title:c==null||c==""?e.name:c,Url:e.id,ID:j,Sort:p,hash:g,refID:i,IsYouTubeVideo:false};if(e.tags[0]=="showcasevideo")b[b.length]={Type:"v",SubType:f,Thumbnail:e.thumbnailURL,Title:e.name,Url:e.id,ID:0,Sort:1,hash:g,IsYouTubeVideo:false};if($jq.inArray(this.marketName+"_"+this.marketID,e.tags)!=-1||$jq.inArray("allmarkets-"+_globalParams.brightCoveSuffix,e.tags)!=-1){var o=1e3;if(e.referenceId!=null&&e.referenceId.indexOf("_")!=-1)o=e.referenceId.substr(e.referenceId.lastIndexOf("_")+1);h[h.length]={Type:"v",SubType:f,Thumbnail:e.thumbnailURL,Title:e.name,Url:e.id,ID:j,Sort:parseInt(o),hash:g,VideoStillURL:e.videoStillURL,IsYouTubeVideo:false}}});if(d.items.length!=0){var i=[];if(typeof mp_mediaItems!="undefined"&&mp_mediaItems!=null)for(var g=0,l=mp_mediaItems.length;g<l;g++)$jq.each(a,function(){mp_mediaItems[g].RefID.toString()==this.refID&&i.push(this)});a=i.groupNSort(function(a){return a.ID},function(a,b){if(a.Sort==b.Sort)return b.Sort.localeCompare(a.Sort);else return a.Sort-b.Sort});if(b.length>1)a=a.concat(b);NHS.Scripts.MediaPlayerVideo._bindTmpl(a,true);var e=a.length;if(!!_imgNLinks&&_imgNLinks.length!=0){NHS.Scripts.MediaPlayerVideo._bindTmpl(_imgNLinks,false);e=e+_imgNLinks.length}var k=j=="sv"?2:3;NHS.Scripts.MediaPlayerVideo._buildCarousel(e,k);if(a.length!=0)NHS.Scripts.MediaPlayerVideo.loadVideo(a[0].Url,a[0].SubType,a[0].Title,1,true,a[0].ID);else NHS.Scripts.MediaPlayerVideo.loadVideo(b[0].Url,b[0].SubType,b[0].Title,1,true,b[0].ID)}};NHS.Scripts.MediaPlayerVideo._bindTmpl=function(a,b){if(typeof a!=="undefined")if(a.length>0){b&&$jq("#videoList").empty();$jq.tmpl("mpTmpl",a).appendTo("#videoList")}};NHS.Scripts.MediaPlayerVideo._buildCarousel=function(a){if(a==0)NHS.Scripts.MediaPlayerVideo._noMedia();else{$jq("#nhs_VideoWrapper").jCarouselLite({circular:a>3,btnNext:"#nhs_VideoPlaylistNext",btnPrev:"#nhs_VideoPlaylistPrev",auto:3700,speed:1800,easing:"swing",visible:Math.min(3,a),scroll:2});NHS.Scripts.MediaPlayerVideo._animate()}NHS.Scripts.MediaPlayerVideo._noOfCarouselItems=a};NHS.Scripts.MediaPlayerVideo._logMedia=function(){if(_mp_listingType=="com")_logger.logEvent("CDVM",_mp_ComID,_mp_builderID);else _logger.logEvent("HDVM",_mp_ComID,_mp_builderID,_mp_PlanID,_mp_SpecID)};NHS.Scripts.MediaPlayerVideo._logVideo=function(b){var a="";if(_mp_listingType=="commres")_logger.logEvent("CRVID",b,0);else if(_mp_listingType=="com"){_logger.logEvent("CDVID",_mp_ComID,_mp_builderID);a="siteCommVV"}else{_logger.logEvent("HDVID",_mp_ComID,_mp_builderID,_mp_SpecID>0?0:_mp_PlanID,_mp_SpecID);a="siteHomeVV"}a!=""&&jQuery.SetDataLayerPair(a)};NHS.Scripts.MediaPlayerVideo._animate=function(){$jq("#nhsplayer").fadeIn(100);$jq("#nhsplayerloading").fadeOut();$jq("#nhsplayerloading").hide()};NHS.Scripts.MediaPlayerVideo._noMedia=function(){$jq("#nhsplayer").hide();$jq("#noImage").fadeIn(100);$jq("#nhsplayerloading").fadeOut();$jq("#nhsplayerloading").hide()};NHS.Scripts.MediaPlayerVideo.loadImage=function(g,b,f,d,c){bcVP.setVisible(false);bcImg.setSource(_imgBaseUrl+g);bcImg.setScaleMode("scaleDown");$jq("#nhsplayerloading").hide();bcVw.setSelectedIndex(1);var a;if(_mp_listingType=="com")a=b=="ci"||b=="lm"?"Community Image":"Home Image";else a=NHS.Scripts.MediaPlayerVideo.lookUpTable[b];var e=d+" of "+NHS.Scripts.MediaPlayerVideo._noOfCarouselItems;a=" Now Showing: "+a;NHS.Scripts.MediaPlayerVideo._displayTitle(f,a,e);$jq("#nhs_MediaMaximize").show();c==false&&NHS.Scripts.MediaPlayerVideo._logMedia()};NHS.Scripts.MediaPlayerVideo.loadVideoByTag=function(b,d,c,e,g,f){if(b!=null){var a=null;jQuery.each(_videos,function(e,d){if(d.tags.length>1&&d.tags[1]==b||d.name==c)a=d.id});a!=null&&NHS.Scripts.MediaPlayerVideo.loadVideo(a,d,c,e,g,f)}};NHS.Scripts.MediaPlayerVideo.loadVideo=function(b,h,f,c,g,d){var a=_mp_listingType=="com"?"Community Video":"Home Video",e=c+" of "+NHS.Scripts.MediaPlayerVideo._noOfCarouselItems;a="Now Showing: "+a;NHS.Scripts.MediaPlayerVideo._displayTitle(f,a,e);$jq("#nhs_MediaMaximize").hide();bcVP.loadVideoByID(b);bcVP.play();$jq("#nhsplayerloading").hide();g==false&&NHS.Scripts.MediaPlayerVideo._logVideo(d)};NHS.Scripts.MediaPlayerVideo.loadVideoValues=function(b,a,d,f,e,c){this.loadURL=b;this.loadSubType=a;this.loadTitle=d;this.loadCue=e;this.loadID=c};NHS.Scripts.MediaPlayerVideo._displayTitle=function(a,b){$jq("#"+mp_captionBarID).text(b);if($jq.trim(a)!=""){$jq("#"+_mp_imgtitleBar).show().text(a);$jq("div.nhs_MediaImageTitle").show()}else $jq("div.nhs_MediaImageTitle").hide()};NHS.Scripts.MediaPlayerVideo._carouselTmpl=$jq.template("mpTmpl","<li>                        {{if Type === 'v'}}                        <a href='javascript:;'   onclick=\"NHS.Scripts.MediaPlayerVideo.loadVideo('${Url}','${SubType}','${Title}',${$index+1}, false, ${ID});\" class=\"video\" >                         <img src=\"${Thumbnail}\" title=\"${Title} \" />                           <span></span>                         </a>                         {{else Type === 'i'}}                         <a href='javascript:;' onclick=\"NHS.Scripts.MediaPlayerVideo.loadImage('${Url}','${SubType}','${Title}','${$index+1}', false);\" class=\"image\">                         <img src=\"${_imgBaseUrl+Thumbnail}\" title=\"${Title}\" />                         </a>                         {{else Type === 'l'}}                         {{html Url}}                         {{/if}}                        </li>");NHS.Scripts.MediaPlayerVideo.lookUpTable={cv:"Community Video",sv:"Community Video",hv:"Home Video",ci:"Community Image",hi:"Home Image",ev:"External Video",pv:"Plan Viewer",vir:"Virtual Tour",ele:"Elevation",flp:"FloorPlan","int":"Interior",ext:"Exterior",lm:"Community Lot Map"};NHS.Scripts.MediaPlayerVideo.GetPageSize=function(){var a=document.documentElement,c=window.innerWidth||self.innerWidth||a&&a.clientWidth||document.body.clientWidth,b=window.innerHeight||self.innerHeight||a&&a.clientHeight||document.body.clientHeight;arrayPageSize=[c,b];return arrayPageSize};NHS.Scripts.MediaPlayerVideo.Zoom=function(b,a){NHS.Scripts.MediaPlayerVideo._prevWidth=$jq(a).width();NHS.Scripts.MediaPlayerVideo._prevHeight=$jq(a).height();var d=$jq(a).width()*1.5,g=$jq(a).height()*1.5,e=NHS.Scripts.MediaPlayerVideo.GetPageSize(),h=e[0],f=e[1],c;if(f>640)c=640;else c=f-50;$jq(b).dialog("destroy");$jq(b).dialog({modal:true,autoStart:false,height:c,width:d+40,resizable:false,hide:"fold",show:"blind",close:function(){$jq(b).dialog("destroy");$jq(b).removeAttr("style").removeAttr("class");$jq(a).width(NHS.Scripts.MediaPlayerVideo._prevWidth).height(NHS.Scripts.MediaPlayerVideo._prevHeight);$jq("#nhsplayerContainer").append($jq(b))}});$jq(a).width(d);$jq(a).height(g);if(mp_timetoSeek>0);$jq(b).dialog("open");bcVP.pause(false)};NHS.Scripts.MediaPlayerVideo.onVideoLoad=function(){typeof mp_timetoSeek!=="undefined"&&bcVP.seek(mp_timetoSeek)};Array.prototype.groupBy=function(d){for(var a=0,e=this.length,b={},c;a<e;a++){if(!b[c="k:"+d(this[a],a,this)])b[c]=[];b[c].push(this[a])}return b};Array.prototype.groupNSort=function(d,c){var b=this.groupBy(d),a=[];for(grp in b){b[grp].sort(c);a=a.concat(b[grp])}return a};(function(a){a.fn.adGallery=function(b){var f={loader_image:b.resource_root+"/GlobalResourcesMvc/Default/images/imgs-player/loader.gif",listingType:b.listingType,start_at_index:0,description_wrapper:false,thumb_opacity:.8,animate_first_image:true,animation_speed:400,width:false,height:false,display_next_and_prev:true,display_back_and_forward:false,scroll_jump:0,slideshow:{enable:true,autostart:false,speed:4e3,start_label:"Start",stop_label:"Stop",stop_on_scroll:false,countdown_prefix:"(",countdown_sufix:")",onStart:false,onStop:false},effect:"fade",mp_type:false,noimg:false,nocdmain:b.resource_root+"/GlobalResourcesMvc/Default/images/blank.gif",wrapperW:false,wrapperH:false,enable_keyboard_move:true,cycle:true,callbacks:{init:false,afterImageVisible:false,beforeImageVisible:false}},d=a.extend(false,f,b);if(b&&b.slideshow)d.slideshow=a.extend(false,f.slideshow,b.slideshow);if(!d.slideshow.enable)d.slideshow.autostart=false;var e=[];a(this).each(function(){var a=new c(this,d);e[e.length]=a});return e};function e(b,e,a){var d=parseInt(b.css("top"),10);if(e=="left"){var c="-"+this.image_wrapper_height+"px";b.css("top",this.image_wrapper_height+"px")}else{var c=this.image_wrapper_height+"px";b.css("top","-"+this.image_wrapper_height+"px")}if(a){a.css("bottom","-"+a[0].offsetHeight+"px");a.animate({bottom:0},this.settings.animation_speed*2)}this.current_description&&this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},this.settings.animation_speed*2);return {old_image:{top:c},new_image:{top:d}}}function d(b,e,a){var d=parseInt(b.css("left"),10);if(e=="left"){var c="-"+this.image_wrapper_width+"px";b.css("left",this.image_wrapper_width+"px")}else{var c=this.image_wrapper_width+"px";b.css("left","-"+this.image_wrapper_width+"px")}if(a){a.css("bottom","-"+a[0].offsetHeight+"px");a.animate({bottom:0},this.settings.animation_speed*2)}this.current_description&&this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},this.settings.animation_speed*2);return {old_image:{left:c},new_image:{left:d}}}function f(a){var e=a.width(),c=a.height(),b=parseInt(a.css("left"),10),d=parseInt(a.css("top"),10);a.css({width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2});return {old_image:{width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2},new_image:{width:e,height:c,top:d,left:b}}}function g(a){a.css("opacity",0);return {old_image:{opacity:0},new_image:{opacity:1}}}function h(a){a.css("opacity",0);return {old_image:{opacity:0},new_image:{opacity:1},speed:0}}function c(b,a){this.init(b,a)}c.prototype={pageClick:1,numclicks:1,maxclicks:0,wrapper:false,image_wrapper:false,gallery_info:false,nav:false,loader:false,preloads:false,thumbs_wrapper:false,scroll_back:false,scroll_forward:false,next_link:false,prev_link:false,thumb_next_link:false,thumb_prev_link:false,slideshow:false,image_wrapper_width:0,image_wrapper_height:0,current_index:0,current_image:false,current_description:false,nav_display_width:0,settings:false,images:false,in_transition:false,animations:false,init:function(g,f){var d=this;this.wrapper=a(g);this.settings=f;this.setupElements();this.setupAnimations();if(this.settings.width){this.image_wrapper_width=this.settings.width;this.image_wrapper.width(this.settings.width);this.wrapper.width(this.settings.width)}else if(_wrapperW>0){this.image_wrapper_width=_wrapperW;this.image_wrapper.width(_wrapperW);this.wrapper.width(_wrapperW)}else this.image_wrapper_width=this.image_wrapper.width();if(this.settings.height){this.image_wrapper_height=this.settings.height;this.image_wrapper.height(this.settings.height)}else if(_wrapperH>0){this.image_wrapper_height=_wrapperH;this.image_wrapper.height(_wrapperH)}else this.image_wrapper_height=this.image_wrapper.height();this.nav_display_width=this.nav.width();this.current_index=0;this.current_image=false;this.current_description=false;this.in_transition=false;this.findImages();this.settings.display_next_and_prev&&this.initNextAndPrev();var e=function(a){return d.nextImage(a)};this.slideshow=new b(e,this.settings.slideshow);this.controls.append(this.slideshow.create());if(this.settings.slideshow.enable)this.slideshow.enable();else this.slideshow.disable();this.settings.display_back_and_forward&&this.initBackAndForward();this.settings.enable_keyboard_move&&this.initKeyEvents();var c=parseInt(this.settings.start_at_index,10);if(window.location.hash&&window.location.hash.indexOf("#ad-image")===0){c=window.location.hash.replace(/[^0-9]+/g,"");if(c*1!=c)c=this.settings.start_at_index}this.loading(true);this.showImage(c,function(){if(d.settings.slideshow.autostart){d.preloadImage(c+1);d.slideshow.start()}});this.fireCallback(this.settings.callbacks.init)},setupAnimations:function(){this.animations={"slide-vert":e,"slide-hori":d,resize:f,fade:g,none:h}},setupElements:function(){this.controls=this.wrapper.find(".ad-controls");this.image_wrapper=this.wrapper.find(".ad-image-wrapper");jQuery(this.image_wrapper).empty();this.image_wrapper.html("");this.nav=a(".ad-nav");this.thumbs_wrapper=this.nav.find(".ad-thumbs");this.preloads=a('<div class="ad-preloads"></div>');var b=this.settings.listingType;if(b=="spec"||b=="plan"){this.thumb_next_link=a("<div class=\"ad-next-thumb\" onclick=\"$jq.googlepush('Images','Home - Gallery','Forward Button');\"><div class=\"ad-next-imageThumb\"></div></div>");this.thumb_prev_link=a("<div class=\"ad-prev-thumb\" onclick=\"$jq.googlepush('Images','Home - Gallery','Back Button');\"><div class=\"ad-prev-imageThumb\"></div></div>")}else{this.thumb_next_link=a('<div class="ad-next-thumb"><div class="ad-next-imageThumb"></div></div>');this.thumb_prev_link=a('<div class="ad-prev-thumb"><div class="ad-prev-imageThumb"></div></div>')}this.nav.append(this.thumb_prev_link);this.nav.append(this.thumb_next_link);a(document.body).append(this.preloads)},loading:function(a){if(a);},addAnimation:function(c,b){if(a.isFunction(b))this.animations[c]=b},findImages:function(){var b=this;this.images=[];var d=0,e=0,f=this.thumbs_wrapper.find("a"),c=f.length;this.settings.thumb_opacity<1&&f.find("img").css("opacity",this.settings.thumb_opacity);var g=c%3;if(g==0)this.maxclicks=(c-g)/3;else this.maxclicks=(c-g)/3+1;f.each(function(h){var f=a(this),g=f.attr("href"),c=f.find("img");if(!b.isImageLoaded(c[0]))c.load(function(){d+=this.parentNode.parentNode.offsetWidth;e++});else{d+=c[0].parentNode.parentNode.offsetWidth;e++}f.addClass("ad-thumb"+h);if(g.indexOf("logredirect")>-1){var k=b.settings.listingType;if(k=="spec"||k=="plan")if(g.indexOf("tour")>-1||g.indexOf("virtual")>-1||g.indexOf("video")>-1||g.indexOf("HDVTCT")>-1)f.click(function(){$jq.googlepush("Outbound Links","Home - Gallery","Home Tour")});else(g.indexOf("floor")>-1||g.indexOf("plan")>-1||g.indexOf("HDPVCT")>-1)&&f.click(function(){$jq.googlepush("Outbound Links","Home - Gallery","Plan Viewer")});f.hover(function(){!a(this).is(".ad-active")&&b.settings.thumb_opacity<1&&a(this).find("img").fadeTo(300,1);b.preloadImage(h)},function(){!a(this).is(".ad-active")&&b.settings.thumb_opacity<1&&a(this).find("img").fadeTo(300,b.settings.thumb_opacity)})}else f.click(function(){b.showImage(h);b.slideshow.stop();var c=h%3,a=(h-c)/3+1;b.numclicks=a;return false}).hover(function(){!a(this).is(".ad-active")&&b.settings.thumb_opacity<1&&a(this).find("img").fadeTo(300,1);b.preloadImage(h)},function(){!a(this).is(".ad-active")&&b.settings.thumb_opacity<1&&a(this).find("img").fadeTo(300,b.settings.thumb_opacity)});var f=false;if(c.data("ad-link"))f=c.data("ad-link");else if(c.attr("longdesc")&&c.attr("longdesc").length)f=c.attr("longdesc");var j=false;if(c.data("ad-desc"))j=c.data("ad-desc");else if(c.attr("alt")&&c.attr("alt").length)j=c.attr("alt");var i=false;if(c.data("ad-title"))i=c.data("ad-title");else if(c.attr("title")&&c.attr("title").length)i=c.attr("title");b.images[h]={thumb:c.attr("src"),image:g,error:false,preloaded:false,desc:j,title:i,size:false,link:f}});var h=setInterval(function(){if(c==e){d-=80;var a=b.nav.find(".ad-thumb-list"),g=1,f=a.height();while(g<201){if(f!=a.height())break;f=a.height();g++}clearInterval(h)}},100)},initKeyEvents:function(){var b=this;a(document).keydown(function(a){if(a.keyCode==39){b.nextImage();b.slideshow.stop()}else if(a.keyCode==37){b.prevImage();b.slideshow.stop()}})},initNextAndPrev:function(){this.thumb_next_link.click(function(){if(b.numclicks<b.maxclicks){if(b.numclicks<b.maxclicks){b.numclicks+=1;if(b.numclicks<=b.maxclicks){var d=b.nav_display_width-50;if(b.settings.scroll_jump>0)var d=b.settings.scroll_jump;var a=b.thumbs_wrapper.scrollLeft()+d;a+=27;b.settings.slideshow.stop_on_scroll&&b.slideshow.stop();b.thumbs_wrapper.animate({scrollLeft:a+"px"})}}}else{var c=b.nav.find(".ad-thumb"+0),a=c[0].parentNode.offsetLeft;a-=b.nav_display_width/2-c[0].offsetWidth/2;a-=14;b.thumbs_wrapper.animate({scrollLeft:a+"px"});b.numclicks=1}return false});this.thumb_prev_link.click(function(){var e=b.numclicks,i=b.current_index;b.numclicks-=1;var f=b.numclicks;if(b.numclicks<1)b.numclicks=1;var h=b.nav_display_width-50;if(b.settings.scroll_jump>0)var h=b.settings.scroll_jump;var a=b.thumbs_wrapper.scrollLeft()-h;a-=27;b.settings.slideshow.stop_on_scroll&&b.slideshow.stop();b.thumbs_wrapper.animate({scrollLeft:a+"px"});if(f==0&&e==1){var g=b.thumbs_wrapper.find("a"),d=g.length,c=b.nav.find(".ad-thumb"+(d-1)),a=c[0].parentNode.offsetLeft;a-=b.nav_display_width/2-c[0].offsetWidth/2;a-=14;b.thumbs_wrapper.animate({scrollLeft:a+"px"});b.numclicks=b.maxclicks}return false});$jq("#nextVid").click(function(){b.nextImage();b.slideshow.stop();var a=b.nav.find(".ad-thumb"+b.current_index);a[0].href.indexOf("brightcove")>-1&&bcVP.stop();if(a[0].href.indexOf("youtu")>-1)player!=undefined&&player.stopVideo();_toggleVideo=0;$jq("#vidP").hide();$jq("#medP").show()});$jq("#prevVid").click(function(){b.prevImage();b.slideshow.stop();var a=b.nav.find(".ad-thumb"+b.current_index);a[0].href.indexOf("brightcove")>-1&&bcVP.stop();if(a[0].href.indexOf("youtu")>-1)player!=undefined&&player.stopVideo();_toggleVideo=0;$jq("#vidP").hide();$jq("#medP").show()});$jq("#prevParent").mouseover(function(){$jq("#prevVid").show()});$jq("#prevParent").mouseout(function(){$jq("#prevVid").hide()});$jq("#nextParent").mouseover(function(){$jq("#nextVid").show()});$jq("#nextParent").mouseout(function(){$jq("#nextVid").hide()});var c=this.settings.listingType;if(c=="spec"||c=="plan"){this.next_link=a('<div class="ad-next" onclick="$jq.googlepush(\'Images\',\'Home - Gallery\',\'Forward Button\');"><div class="ad-next-image" title="Next"></div></div>');this.prev_link=a('<div class="ad-prev" onclick="$jq.googlepush(\'Images\',\'Home - Gallery\',\'Back Button\');"><div class="ad-prev-image" title="Previous"></div></div>')}else{this.next_link=a('<div class="ad-next"><div class="ad-next-image" title="Next"></div></div>');this.prev_link=a('<div class="ad-prev"><div class="ad-prev-image" title="Previous"></div></div>')}this.image_wrapper.append(this.next_link);this.image_wrapper.append(this.prev_link);var b=this;this.prev_link.add(this.next_link).mouseover(function(){a(this).css("height",b.image_wrapper_height);a(this).find("div").show()}).mouseout(function(){a(this).find("div").hide()}).click(function(){if(a(this).is(".ad-next")){b.nextImage();b.slideshow.stop()}else{b.prevImage();b.slideshow.stop()}}).find("div")},initBackAndForward:function(){var b=this;this.scroll_forward=a('<a class="ad-forward">Next</a>');this.scroll_back=a('<a class="ad-back">Previous</a>');this.nav.append(this.scroll_forward);this.nav.prepend(this.scroll_back);var c=0,d=false;a(this.scroll_back).add(this.scroll_forward).click(function(){var c=b.nav_display_width-50;if(b.settings.scroll_jump>0)var c=b.settings.scroll_jump;if(a(this).is(".ad-forward"))var d=b.thumbs_wrapper.scrollLeft()+c;else var d=b.thumbs_wrapper.scrollLeft()-c;b.settings.slideshow.stop_on_scroll&&b.slideshow.stop();b.thumbs_wrapper.animate({scrollLeft:d+"px"});b.slideshow.start();return false}).css("opacity",.6).hover(function(){var e="left";if(a(this).is(".ad-forward"))e="right";d=setInterval(function(){c++;c>30&&b.settings.slideshow.stop_on_scroll&&b.slideshow.stop();var a=b.thumbs_wrapper.scrollLeft()+1;if(e=="left")a=b.thumbs_wrapper.scrollLeft()-1;b.thumbs_wrapper.scrollLeft(a)},10);a(this).css("opacity",1)},function(){c=0;clearInterval(d);a(this).css("opacity",.6)})},_afterShow:function(){$jq("#nhs_ImagePlayerItemCounts").html(this.current_index+1+" of "+this.images.length);$jq("#nhs_VideoPlayerItemCounts").html($jq("#nhs_ImagePlayerItemCounts").html());if(!this.settings.cycle){this.prev_link.show().css("height",this.image_wrapper_height);this.next_link.show().css("height",this.image_wrapper_height);this.current_index==this.images.length-1&&this.next_link.hide();this.current_index==0&&this.prev_link.hide()}this.fireCallback(this.settings.callbacks.afterImageVisible)},_getContainedImageSize:function(b,a){if(a>this.image_wrapper_height){var c=b/a;a=this.image_wrapper_height;b=this.image_wrapper_height*c}if(b>this.image_wrapper_width){var c=a/b;b=this.image_wrapper_width;a=this.image_wrapper_width*c}return {width:b,height:a}},_centerImage:function(a,c,b){a.css("top","32px");if(b<this.image_wrapper_height){var d=this.image_wrapper_height-b;a.css("top",d/2+32+"px")}a.css("left","0px");if(c<this.image_wrapper_width){var d=this.image_wrapper_width-c;a.css("left",d/2+"px")}},_getDescription:function(b){var c=false;if(b.desc.length||b.title.length){var d="";if(b.title.length)d='<strong class="ad-description-title">'+b.title+"</strong>";var c="";if(b.desc.length)c="<span>"+b.desc+"</span>";c=a('<p class="ad-image-description">'+d+c+"</p>")}return c},showImageThumb:function(b,a){this._showWhenLoadedThumb(b,a)},showImage:function(b,e){var g;(this.images[b]==undefined||this.images.length==0)&&this.findImages();g=this.images[b];if(g.error){this.images[b].image=this.settings.nocdmain;this.images[b].error=false;this.in_transition=false}var f=a(new Image);f.attr("src",this.images[b].image);if(!this.isImageLoaded(f[0])){var c=this;f.load(function(){}).error(function(){c.loading(false);c.images[b].image=c.settings.nocdmain;c.images[b].error=false;c.in_transition=false;c.showImage(b,e)})}if(this.images[b]&&!this.in_transition){var c=this,d=this.images[b];if(d.error){d.image=this.settings.nocdmain;d.error=false}this.in_transition=true;if(!d.preloaded){this.loading(true);this.preloadImage(b,function(){c.loading(false);c._showWhenLoaded(b,e)})}else this._showWhenLoaded(b,e)}},_showWhenLoadedThumb:function(c,k){if(this.images[c]){var l=this.images[c],d=a(".ad-image"),g=this._getDescription(l,d);this.highLightThumb(this.nav.find(".ad-thumb"+c),c);var i="right";if(this.current_index<c)i="left";this.fireCallback(this.settings.callbacks.beforeImageVisible);if(this.current_image||this.settings.animate_first_image){var e=this.settings.animation_speed,f="swing",b=this.animations[this.settings.effect].call(this,d,i,g);if(typeof b.speed!="undefined")e=b.speed;if(typeof b.easing!="undefined")f=b.easing;if(this.current_image){var j=this.current_image,h=this.current_description;j.animate(b.old_image,e,f,function(){j.remove();h&&h.remove()})}d.animate(b.new_image,e,f,function(){context.current_index=context.current_index;context.current_image=d;context.current_description=g;context.in_transition=false;context._afterShow();context.fireCallback(k)})}else{this.current_index=c;this.current_image=d;context.current_description=g;this.in_transition=false;context._afterShow();this.fireCallback(k)}}},_showWhenLoaded:function(c,n){if(this.images[c]){var d=this;$jq("#nhs_ImagePlayerCaption").text(_globalCaption[c]);$jq("#nhs_MediaPlayerCaption").text(_globalCaption[c]);var f=this.images[c],b=a(document.createElement("div")).addClass("ad-image");b.attr("z-index","10");var q=a(new Image).attr("src",f.image);if(f.link){var p=a('<a href="'+f.link+'" target="_blank" ></a>');p.append(q);b.append(p)}else b.append(q);this.image_wrapper.prepend(b);size={width:460,height:307};var e=this._getDescription(f,b);if(e)if(!this.settings.description_wrapper){b.append(e);var s=size.width-parseInt(e.css("padding-left"),10)-parseInt(e.css("padding-right"),10)}else this.settings.description_wrapper.append(e);if(f.image.indexOf("brightcove")>-1||f.image.indexOf("youtu")>-1){var i=a(document.createElement("span"));b.append(i);var r=b.css("width").replace("px","");i.css("left","0px");var o=this.nav.find(".ad-thumb"+c)[0];a(o).attr("tmpclick")!=null&&i.attr("onclick",a(o).attr("tmpclick"))}else updatePinterest(f.image,false);this.highLightThumb(this.nav.find(".ad-thumb"+c),c);var l="right";if(this.current_index<c)l="left";this.fireCallback(this.settings.callbacks.beforeImageVisible);if(this.current_image||this.settings.animate_first_image){var h=this.settings.animation_speed,j="swing",g=this.animations[this.settings.effect].call(this,b,l,e);if(typeof g.speed!="undefined")h=g.speed;if(typeof g.easing!="undefined")j=g.easing;if(this.current_image){var m=this.current_image,k=this.current_description;m.animate(g.old_image,h,j,function(){m.remove();k&&k.remove()})}b.animate(g.new_image,h,j,function(){d.current_index=c;d.current_image=b;d.current_description=e;d.in_transition=false;d._afterShow();d.fireCallback(n)})}else{this.current_index=c;this.current_image=b;d.current_description=e;this.in_transition=false;d._afterShow();this.fireCallback(n)}}},nextIndex:function(){if(this.current_index==this.images.length-1){if(!this.settings.cycle)return false;var a=0}else var a=this.current_index+1;return a},nextImageThumb:function(b){var a=this.nextIndex();if(a===false)return false;this.showImageThumb(a,b);return true},nextImage:function(c){var a=this.nextIndex();if(a===false)return false;this.preloadImage(a+1);this.showImage(a,c);var d=a%3,b=(a-d)/3+1;this.numclicks=b;return true},prevIndex:function(){if(this.current_index==0){if(!this.settings.cycle)return false;var a=this.images.length-1}else var a=this.current_index-1;return a},prevImage:function(c){var a=this.prevIndex();if(a===false)return false;this.preloadImage(a-1);this.showImage(a,c);var d=a%3,b=(a-d)/3+1;this.numclicks=b;return true},preloadAll:function(){var b=this,a=0;function c(){if(a<b.images.length){a++;b.preloadImage(a,c)}}b.preloadImage(a,c)},preloadImage:function(e,d){if(this.images[e]){var b=this.images[e];if(!this.images[e].preloaded){var c=a(new Image);c.attr("src",b.image);if(!this.isImageLoaded(c[0])){this.preloads.append(c);var f=this;c.load(function(){b.preloaded=true;b.size={width:this.width,height:this.height};f.fireCallback(d)}).error(function(){b.error=true;b.preloaded=false;b.size=false})}else{b.preloaded=true;b.size={width:c[0].width,height:c[0].height};this.fireCallback(d)}}else this.fireCallback(d)}},isImageLoaded:function(a){if(typeof a.complete!="undefined"&&!a.complete)return false;if(typeof a.naturalWidth!="undefined"&&a.naturalWidth==0)return false;return true},highLightThumb:function(a,c){this.thumbs_wrapper.find(".ad-active").removeClass("ad-active");a.addClass("ad-active");player!=undefined&&player.stopVideo();$jq("#vidP").hide();$jq("#medP").show();_toggleVideo=0;if(this.settings.thumb_opacity<1){this.thumbs_wrapper.find("a:not(.ad-active) img").fadeTo(300,this.settings.thumb_opacity);a.find("img").fadeTo(300,1)}var b=a[0].parentNode.offsetLeft;b-=this.nav_display_width/2-a[0].offsetWidth/2;b-=14;if(this.current_index>c)this.thumbs_wrapper.animate({scrollLeft:b+"px"});else c!=1&&this.thumbs_wrapper.animate({scrollLeft:b+"px"})},fireCallback:function(b){a.isFunction(b)&&b.call(this)}};function b(a,b){this.init(a,b)}b.prototype={start_link:false,stop_link:false,countdown:false,controls:false,settings:false,nextimage_callback:false,enabled:false,running:false,countdown_interval:false,init:function(a,b){var c=this;this.nextimage_callback=a;this.settings=b},create:function(){this.start_link=a('<span class="ad-slideshow-start">'+this.settings.start_label+"</span>");this.stop_link=a('<span class="ad-slideshow-stop">'+this.settings.stop_label+"</span>");this.countdown=a('<span class="ad-slideshow-countdown"></span>');this.countdown.hide();var b=this;this.start_link.click(function(){b.start()});this.stop_link.click(function(){b.stop()});a(document).keydown(function(a){if(a.keyCode==83)if(b.running)b.stop();else b.start()});return this.controls},disable:function(){this.enabled=false;this.stop();this.controls.hide()},enable:function(){this.enabled=true},toggle:function(){if(this.enabled)this.disable();else this.enable()},start:function(){if(this.running||!this.enabled)return false;var a=this;this.running=true;this._next();this.fireCallback(this.settings.onStart);return true},stop:function(){if(!this.running)return false;this.running=false;this.countdown.hide();clearInterval(this.countdown_interval);this.fireCallback(this.settings.onStop);return true},_next:function(){var a=this,c=this.settings.countdown_prefix,d=this.settings.countdown_sufix;clearInterval(a.countdown_interval);this.countdown.show().html(c+this.settings.speed/1e3+d);var b=0;this.countdown_interval=setInterval(function(){b+=1e3;if(b>=a.settings.speed){var f=function(){a.running&&a._next();b=0};!a.nextimage_callback(f)&&a.stop();b=0}var e=parseInt(a.countdown.text().replace(/[^0-9]/g,""),10);e--;e>0&&a.countdown.html(c+e+d)},1e3)},fireCallback:function(b){a.isFunction(b)&&b.call(this)}}})(jQuery);var bcExp,bcVP,bcImg,bcVw,_imageBaseUrl,_imgNLinks,_youtubeLinks,_mp_listingType,_isBasicCommunity,_bcExperienceID,mp_captionBarIDNew,_videos,_currentObjCache,_imgList,_myW,_toggleVideo,_youtubeCreated,_globalParams,_globalCaption,_ended,gnocdmain,gnoimgMed,gnoimgLarge,glistingType;GallerylookUpTable={cv:"Community Video",sv:"Community Video",hv:"Home Video",ci:"Community Image",hi:"Home Image",ev:"External Video",pv:"Plan Viewer",vir:"Virtual Tour",vt:"Virtual Tour",ele:"Elevation",flp:"FloorPlan","int":"Interior",ext:"Exterior",lm:"Community Lot Map"};function UpdateResPlayer(){$jq(".ad-gallery").css("width","300px");$jq(".ad-gallery").css("height","240px");$jq(".nhs_ImagePlayerBox").css("width","300px");$jq(".nhs_ImagePlayerBox").css("height","240px");$jq(".nhs_ImagePlayerBox object").css("width","300px");$jq(".nhs_ImagePlayerTitleBar").css("width","300px");$jq(".ad-gallery .ad-image-wrapper").css("height","194px");$jq(".ad-gallery .ad-nav").css("width","265px");$jq(".ad-gallery .ad-nav .ad-thumbs").css("width","234px");$jq(".ad-nav .ad-thumbs").css("width","256px")}DisplayNoMedia=function(a){var b=$jq('<img src="'+a+'globalresourcesmvc/default/images/nophoto_460x307.jpg" alt="No photo or video available" />');$jq(".ad-gallery .ad-image-wrapper").append(b)};function InitGallery(a){_ended=false;_youtubeCreated=false;a.hasOwnProperty("titleBarText")&&$jq("#nhs_ImagePlayerTitle").text(a.titleBarText);_globalParams=a;if(a.mediaObjs.length==0&&a.externalLinks!=undefined&&a.externalLinks.length==0&&a.type!="results")DisplayNoMedia(a.imgStaticUrl);else{var b=a.hasOwnProperty("specID")?"spec":a.hasOwnProperty("planID")?"plan":a.hasOwnProperty("communityID")?"com":"commres";glistingType=b;var c=a.imgStaticUrl+"globalresourcesmvc/default/images/nophoto_460x307.jpg",e=a.imgStaticUrl+"globalresourcesmvc/default/images/nophoto_med.png",d=a.imgStaticUrl+"globalresourcesmvc/default/images/imgs-player/blank.gif";if(b=="commres"){_wrapperW=300;_wrapperH=194}else{_wrapperW=0;_wrapperH=0}glistingType=b;gnocdmain=d;gnoimgLarge=c;gnoimgMed=e;ProcessParams(a)}}function AfterProcess(){$jq(function(){var b={resource_root:_globalParams.imgBaseUrl,listingType:glistingType},a=$jq(".ad-gallery").adGallery(b);a[0].settings.effect="fade";a[0].settings.mp_type=glistingType;a[0].settings.nocdmain=gnocdmain;if(glistingType=="com")a[0].settings.noimg=gnoimgLarge;else{a[0].settings.noimg=gnoimgMed;a[0].settings.wrapperW=300;a[0].settings.wrapperH=124}})}function HideImgTitle(){$jq("div.nhs_MediaImageTitle").hide()}function SetCaption(f,b,c){var a;if(_mp_listingType=="com")a=b=="ci"||b=="lm"?"Community Image":"Home Image";else a=GallerylookUpTable[b];if(_globalParams.hasOwnProperty("captionBarText"))a=_globalParams.captionBarText+a;else a=" Now Showing: "+a;$jq("#"+mp_captionBarID).text(a);$jq.trim(c)==""&&$jq("div.nhs_MediaImageTitle").hide()}function GoBack(){$jq("#vidP").hide();$jq("#medP").show()}function GetCaption(b){var a;if(_mp_listingType=="com")if(b.Type=="v")a=b.SubType=="cv"||b.SubType=="sv"||b.SubType==null?"Community Video":"Home Video";else if(b.Type=="i")a=b.SubType=="ci"||b.SubType=="lm"?"Community Image":"Home Image";else a=GallerylookUpTable[b.SubType];else{a=GallerylookUpTable[b.SubType];if(a==null)a="Home Video"}if(_globalParams.hasOwnProperty("captionBarText"))a=_globalParams.captionBarText+a;else a=" Now showing: "+a;return a}function GalleryloadImage(k,a,j,i,g,e,f,c,l){var b;if(_mp_listingType=="com")if(e)b=a=="cv"||a=="sv"?"Community Video":"Home Video";else b=a=="ci"||a=="lm"?"Community Image":"Home Image";else b=GallerylookUpTable[a];b=" Now Showing: "+b;$jq("#"+mp_captionBarIDNew).text(b);_mp_listingType=="commres"&&$jq.googlepush("Videos","Search Results","Community");var d="",h=k.indexOf("youtu")!=-1;$jq("#medP").show();$jq("#vidP").hide();if(e){if(_toggleVideo!=1){$jq("#medP").hide();$jq("#vidP").show();if(h){$jq("#nhsplayerloading").hide();$jq("#brightcoveP").hide();$jq("#youtubeP").show()}else{$jq("#nhsplayerloading").show();player!=undefined&&player.stopVideo();$jq("#youtubeP").hide();$jq("#brightcoveP").show()}}this.myvidid=c;this.mysubtype=a;this.mytitle=j;this.myindex=i;this.mycue=g;this.myid=f;if(h){if(!_youtubeCreated){createPlayer("youtubeP",c,460,307);_youtubeCreated=true}else player.loadVideoById(c);NHS.Scripts.MediaPlayerVideo._logVideo(f)}else this.allLoaded&&NHS.Scripts.MediaPlayerVideo.loadVideo(c,a,j,i,g,f);_toggleVideo=1;d=l}else{if(_toggleVideo==1){player!=undefined&&player.stopVideo();$jq("#vidP").hide();$jq("#medP").show()}_toggleVideo=0;d=_imgBaseUrl+k;if(!_isBasicCommunity)if(_mp_listingType=="spec"||_mp_listingType=="plan")$jq.googlepush("Images","Home - Gallery","Select Images");else $jq.googlepush("Images","Community - Gallery","Select Images")}updatePinterest(d,e)}function updatePinterest(b,d){var a=$jq(".nhs_MediaPlayerContainer .pin-it-button");if(a.length>0){var c="http://pinterest.com/pin/create/button/?url="+encodeURIComponent(_globalParams.url)+"&media="+encodeURIComponent(b)+"&description="+encodeURIComponent(d?"Video!: "+_globalParams.description:_globalParams.description);a.attr("href",c);_globalParams.firstImgUrl=b}}function ProcessParams(a){if(a.mediaObjs.length==0)mp_mediaItems=null;else mp_mediaItems=a.mediaObjs;_imgBaseUrl=a.imgBaseUrl;_isBasicCommunity=a.isBasicCommunity;_mp_listingType=a.hasOwnProperty("specID")?"spec":a.hasOwnProperty("planID")?"plan":a.hasOwnProperty("communityID")?"com":"commres";this._externalLinks=a.externalLinks;_bcExperienceID=a.bcExperienceID;this._titlebarID=a.titleBarID;var b=_globalParams.hasOwnProperty("captionBarText");_mp_listingType=="com"?$jq("#"+this._titlebarID).text(b?_globalParams.titleBarText:"Community Gallery"):_mp_listingType=="commres"?$jq("#"+this._titlebarID).text(b?"Tour video gallery":"Community video gallery"):$jq("#"+this._titlebarID).text(b?_globalParams.titleBarText:"Home Gallery");mp_captionBarIDNew=a.captionBarID;_mp_imgtitleBar=a.imgtitleBar;var c;if(a.type=="community"||a.type=="home")_loadDetailsMediaPlayer("_popComVideos");else a.type=="results"&&_loadShowCasePlayer("_popShowcaseVideos")}_loadDetailsMediaPlayer=function(b){this._initialize(b);var a=this._getTags(),c=a!="";if(c)BCMAPI.find("find_videos_by_tags",{or_tags:a,fields:"id,referenceId,thumbnailURL,tags,videoStillURL"});else _popImgnLnksFromMediaItems(false)};_loadShowCasePlayer=function(c){this._initialize(c);var a=this._getTags(),d=a!="",b=_globalParams.marketName+"_"+_globalParams.marketID;a+=a!==""?",showcasevideo,":"showcasevideo";a=b+",allmarkets-"+_globalParams.brightCoveSuffix+","+a;BCMAPI.find("find_videos_by_tags",{or_tags:a,fields:"name,id,referenceId,thumbnailURL,tags,videoStillURL"})};_getTags=function(){var a="";if(mp_mediaItems!=null){jQuery.each(mp_mediaItems,function(c,b){if(b.Type==="v")a+=b.VideoID+","});a=a.substr(0,a.length-1)}return a};_popComVideos=function(a){_popVideos(a,"cv")};_popShowcaseVideos=function(a){_popVideos(a,"sv")};function initializePinterest(a){updatePinterest(a.items[0].videoStillURL,true)}_popVideos=function(c,j){_currentObjCache._popImgnLnksFromMediaItems(c.items.length!=0);c.items.length>0&&initializePinterest(c);var a=[],d=[],b=[],o=GallerylookUpTable,f=j,e="";jQuery.each(c.items,function(r,g){var j=0,p=0,i=0;if(g.referenceId==null)g.referenceId="";if(g.tags.length>=2){var h=g.tags[1],k=g.tags[0];if(h.indexOf("-")!=-1){var q=k;k=h;h=q}var l=k.split("-");if(l.length>2){j=l[1];i=l[2]}var n=true;mp_mediaItems!=null&&g.tags[0]!="showcasevideo"&&jQuery.each(mp_mediaItems,function(b,a){if(a.RefID==i){n=false;e=a.Title;p=a.Sort*1;return false}})}_videos=c.items;var m=false;a.length>0&&h!=""&&g.tags[0]!="showcasevideo"&&jQuery.each(a,function(b,a){if(h==a.hash){m=true;return false}});if(!m&&!n&&g.tags[0]!="showcasevideo")a[a.length]={Type:"v",SubType:f,Thumbnail:g.thumbnailURL,Title:e==null||e==""?g.name:e,Url:g.id,ID:j,Sort:p,hash:h,refID:i,VideoStillURL:g.videoStillURL,IsYouTubeVideo:false};if(g.tags[0]=="showcasevideo")d[d.length]={Type:"v",SubType:f,Thumbnail:g.thumbnailURL,Title:g.name,Url:g.id,ID:0,Sort:1,hash:h,VideoStillURL:g.videoStillURL,IsYouTubeVideo:false};if($jq.inArray(_globalParams.marketName+"_"+_globalParams.marketID,g.tags)!=-1||$jq.inArray("allmarkets-"+_globalParams.brightCoveSuffix,g.tags)!=-1){var o=1e3;if(g.referenceId!=null&&g.referenceId.indexOf("_")!=-1)o=g.referenceId.substr(g.referenceId.lastIndexOf("_")+1);b[b.length]={Type:"v",SubType:f,Thumbnail:g.thumbnailURL,Title:g.name,Url:g.id,ID:j,Sort:parseInt(o),hash:h,VideoStillURL:g.videoStillURL,Ref:g.referenceId,IsYouTubeVideo:false}}});if(c.items.length!=0){var i=[];if(typeof mp_mediaItems!="undefined"&&mp_mediaItems!=null)for(var g=0,m=mp_mediaItems.length;g<m;g++)$jq.each(a,function(){mp_mediaItems[g].RefID.toString()==this.refID&&i.push(this)});a=i.groupNSort(function(a){return a.ID},function(a,b){return a.Sort-b.Sort});if(d.length>0)a=a.concat(d);if(b.length>0){b=b.sort(function(c,d){var a=c.Sort,b=d.Sort;if(a<b)return -1;if(a>b)return 1;a=c.Ref.indexOf("allmarkets")!=-1?"z":c.Ref;b=d.Ref.indexOf("allmarkets")!=-1?"z":d.Ref;return a.localeCompare(b)});a=b.concat(a)}var h=a.length;if(!!_imgNLinks&&_imgNLinks.length!=0)h=h+_imgNLinks.length;var n=j=="sv"?2:3,k=_imgNLinks.length>0,l=a.length>0;_globalCaption=[];jQuery.each(a,function(b,a){_globalCaption.push(GetCaption(a))});jQuery.each(_imgNLinks,function(b,a){_globalCaption.push(GetCaption(a))});if(l){if(_mp_listingType=="com")caption=a[0].SubType=="cv"?"Community Video":"Home Video";else caption=GallerylookUpTable[a[0].SubType];caption="Now Showing: "+caption;$jq("#"+mp_captionBarIDNew).text(caption)}else if(k){if(_mp_listingType=="com")caption=_imgNLinks[0].SubType=="ci"||_imgNLinks[0].SubType=="lm"?"Community Image":"Home Image";else caption=GallerylookUpTable[_imgNLinks[0].SubType];caption="Now Showing: "+caption;$jq("#"+mp_captionBarIDNew).text(caption)}mytemp=$jq.template("mpTmpl","<li>                        {{if IsYouTubeVideo }}                         <a href=\"${Thumbnail}\"   tmpclick=\"GalleryloadImage('${Thumbnail}','${SubType}','${Title}','${$index+1}', false, true, 0, '${OnlineVideoID}','${Thumbnail}');\" >                         <img src=\"${Thumbnail}\" title=\"${Title} \" class=\"image0\" />                           <span></span>                         </a>                        {{/if}}                         {{if Type === 'v' && !IsYouTubeVideo}}                         <a href=\"${VideoStillURL}\"   tmpclick=\"GalleryloadImage('${Thumbnail}','${SubType}','${Title}','${$index+1}', false, true, ${ID}, '${Url}','${VideoStillURL}');\" >                         <img src=\"${Thumbnail}\" title=\"${Title} \" class=\"image0\" />                           <span></span>                         </a>                         {{/if}}                          {{if Type === 'i'}}                         <a href=\"${_imgBaseUrl+Url}\" tmpclick=\"GalleryloadImage('${Url}','${SubType}','${Title}','${$index+1}', false, false);\"  >                         <img src=\"${_imgBaseUrl+Thumbnail}\" title=\"${Title}\" class=\"image0\"  />                         </a>                         {{else Type === 'l'}}                         {{html Url}}                         {{/if}}                        </li>");$jq("#galleryList").empty();$jq.tmpl("mpTmpl",a).appendTo("#galleryList");$jq.tmpl("mpTmpl",_imgNLinks).appendTo("#galleryList");AfterProcess()}};Array.prototype.groupBy=function(d){for(var a=0,e=this.length,b={},c;a<e;a++){if(!b[c="k:"+d(this[a],a,this)])b[c]=[];b[c].push(this[a])}return b};Array.prototype.groupNSort=function(d,c){var b=this.groupBy(d),a=[];for(grp in b){b[grp].sort(c);a=a.concat(b[grp])}return a};_initialize=function(a){BCMAPI.token="HYWld5USmeg7f3O0xaq2UgSaQBVyuw72JRRcM_k4sRX7yIGlb-lcuQ..";BCMAPI.callback=a;_currentObjCache=this};_popImgnLnksFromMediaItems=function(c){_imgNLinks=[];_youtubeLinks=[];var a=false,b=false;if(mp_mediaItems!=null){var d=mp_mediaItems;jQuery.each(d,function(d,c){if(c.Type==="i"){_imgNLinks.push(c);a=true}else if(c.Type=="v"&&c.IsYouTubeVideo){_youtubeLinks.push(c);b=true}})}if(_currentObjCache._externalLinks!=null&&_currentObjCache._externalLinks.length>0){var e=_currentObjCache._externalLinks;jQuery.each(e,function(c,b){_imgNLinks.push(b);a=true})}if(!c){a=_imgNLinks.length>0;if(a){if(_mp_listingType=="com")caption=_imgNLinks[0].SubType=="ci"||_imgNLinks[0].SubType=="lm"?"Community Image":"Home Image";else caption=GallerylookUpTable[_imgNLinks[0].SubType];caption="Now Showing: "+caption;$jq("#"+mp_captionBarIDNew).text(caption)}if(!c&&!a&&!b)DisplayNoMedia(_imgBaseUrl);else{mytemp=$jq.template("mpTmpl","<li>                        {{if IsYouTubeVideo }}                         <a href=\"${Thumbnail}\"   tmpclick=\"GalleryloadImage('${Url}','${SubType}','${Title}','${$index+1}', false, true, 0, '${OnlineVideoID}','${Thumbnail}');\" >                            <img src=\"${Thumbnail}\" title=\"${Title} \" class=\"image0\" />                           <span></span>                         </a>                        {{/if}}                        {{if Type === 'v' && !IsYouTubeVideo}}                        <a href=\"${VideoStillURL}\"   tmpclick=\"GalleryloadImage('${Thumbnail}','${SubType}','${Title}','${$index+1}', false, true, ${ID}, '${Url}','${VideoStillURL}');\" >                            <img src=\"${Thumbnail}\" title=\"${Title} \" class=\"image0\" />                           <span></span>                         </a>                        {{/if}}                        {{if Type === 'i'}}                         <a href=\"${_imgBaseUrl+Url}\" tmpclick=\"GalleryloadImage('${Url}','${SubType}','${Title}','${$index+1}', false, false);\"  >                            <img src=\"${_imgBaseUrl+Thumbnail}\" title=\"${Title}\" class=\"image0\"  />                         </a>                         {{else Type === 'l'}}                            {{html Url}}                         {{/if}}                        </li>");_globalCaption=[];jQuery.each(_youtubeLinks,function(b,a){_globalCaption.push(GetCaption(a))});jQuery.each(_imgNLinks,function(b,a){_globalCaption.push(GetCaption(a))});$jq("#galleryList").empty();$jq.tmpl("mpTmpl",_youtubeLinks).appendTo("#galleryList");$jq.tmpl("mpTmpl",_imgNLinks).appendTo("#galleryList");AfterProcess()}}};NHS.Scripts.CommunityResults.Map=function(a){this._partnerId=a.partnerID;this._brandPartnerId=a.brandPartnerId;this._siteRoot=a.siteRoot;this._communityPage=a.communityPage;this._communityResultsPage=a.communityResultsPage;this._basicListingPage=a.basicListingPage;this._basicCommPage=a.basicCommPage;this._resourceRoot=a.resourceRoot;this._mapContainerId=a.mapContainerId;this._searchMapAreaParagraphId=a.searchMapAreaParagrapId;this._mapLoadingId=a.mapLoadingId;this._mapTipBox=a.mapTipBoxId;this._mapMaxResultsMsgId=a.mapMaxResultsMsgId;this._mqZoom=null;this._maxResults=a.maxResults;this._isBuilderMap=a.isBuilderMap;this._brandId=a.brandId;this._marketId=a.marketId;this._brandName=a.brandName;this._mapWidth=a.Width;this._mapHeight=a.Height;this._mapCommsAction=a.mapCommsAction;this._mapMarketsAction=a.mapMarketsAction;this._mapStatesAction=a.mapStatesAction;if(this._brandPartnerId==333){this._mqIconPath=this._resourceRoot+"globalresources/move/images/map/marker.gif";this._mqIconMultPath=this._resourceRoot+"globalresources/move/images/map/marker_multiple.gif";this._mqIconMktPath=this._resourceRoot+"globalresources/move/images/map/marker_market.gif"}else{this._mqIconPath=this._resourceRoot+"globalresources/default/images/map/marker.gif";this._mqIconMultPath=this._resourceRoot+"globalresources/default/images/map/marker_multiple.gif";this._mqIconMktPath=this._resourceRoot+"globalresources/default/images/map/mkt_icon.gif"}this._mqBLIconPath=this._resourceRoot+"globalresourcesmvc/default/images/map/marker_basic.png";this._mqIconShadowPath=this._resourceRoot+"globalresources/default/images/map/marker_shadow.png";this._viewOnMapLinkScript=a.viewOnMapLinkScript;this._freeBrochureLink=a.freeBrochureLink;this._requestPromoLink=a.requestPromoLink;this._requestAppointmentLink=a.requestAppointmentLink;this._pageUrl=document.location.href;this._iteration=0;this._isBeingShowed=false;this._updateMapFlag=true;this._doingViewonMap=false;this._updateResultsFlag=true;this._nhsMqMap=null;this._nhsMapIconShadow=null;this._mqOrigZoom=null;this._mqOrigCenter=null;this._mqCenter=null;this._mqIconOffset=null;this._nhsMapIconMult=null;this._mqIconMultOffset=null;this._nhsMapIcon=null;this._nhsMapIconMkt=null;this._mqIconMktOffset=null;this._mqMoveRefPoint=null;this._prevBrowserSize=null;this._searchParameters=a.searchParams;this._mqMinLat=a.mqMinLat;this._mqMinLng=a.mqMinLng;this._mqMaxLat=a.mqMaxLat;this._mqMaxLng=a.mqMaxLng;this._mqCenterLat=a.mqCenterLat;this._mqCenterLng=a.mqCenterLng;this._mqZoomLevel=a.mqZoomLevel;this._commResults=a.commResults;if(typeof this._commResults!="undefined")this._log=this._commResults.get_log();else this._log=a.logger};NHS.Scripts.CommunityResults.Map.prototype={get_searchParameters:function(){return this._searchParameters},set_searchParameters:function(a){this._searchParameters=a},get_log:function(){return this._log},get_updateMapFlag:function(a){this._updateMapFlag=a},get_updateResultsFlag:function(a){this._updateResultsFlag=a},show:function(){if(!this._isBeingShowed){this._resizeMapDiv();this._mqZoom=this._mqZoomLevel;this._mqOrigZoom=this._mqZoom;this._mqOrigCenter=new MQA.LatLng(this._mqCenterLat,this._mqCenterLng);this._mqCenter=this._mqOrigCenter;this._nhsMqMap=new MQA.TileMap(document.getElementById(this._mapContainerId),this._mqZoom,this._mqOrigCenter,"map");this._nhsMapIconShadow=new MQA.Icon(this._mqIconShadowPath,0,0);this._nhsMapIcon=new MQA.Icon(this._mqIconPath,20,26);this._nhsBLMapIcon=new MQA.Icon(this._mqBLIconPath,14,14);this._mqIconOffset=new MQA.Point(-10,-26);this._nhsMapIconMult=new MQA.Icon(this._mqIconMultPath,28,28);this._mqIconMultOffset=new MQA.Point(-14,-28);this._nhsMapIconMkt=new MQA.Icon(this._mqIconMktPath,40,37);this._mqIconMktOffset=new MQA.Point(-20,-37);this._mqMoveRefPoint=this._nhsMqMap.pixToLL(new MQA.Point(0,0));var a=null;if(!this._isBuilderMap){a=new MQA.ZoomControl;this._nhsMqMap.addControl(a,new MQA.MapCornerPlacement(MQA.MapCorner.TOP_LEFT,new MQA.Size(10,21)))}else{a=new MQA.LargeZoomControl;this._nhsMqMap.addControl(a,new MQA.MapCornerPlacement(MQA.MapCorner.TOP_RIGHT,new MQA.Size(10,21)))}this._setMapWindowCoordinates();if(this.mqZoom<7)$jq("#"+this._searchMapAreaParagraphId).hide();else $jq("#"+this._searchMapAreaParagraphId).show();this._prevBrowserSize=this._getBrowserSize();this.browserResize();if(!this._isBuilderMap){MQA.EventManager.addListener(this._nhsMqMap,"zoomEnd",function(a){this.get_log().logEvent("MAPZOOM",0,0);this._zoomEnd(a)}.bind(this));MQA.EventManager.addListener(this._nhsMqMap,"moveend",this._mapMoveEnd.bind(this))}MQA.EventManager.addListener(this._nhsMqMap.getInfoWindow(),"opened",this._infoWindowOpen);MQA.EventManager.addListener(this._nhsMqMap.getInfoWindow(),"closed",this._infoWindowClose);MQA.EventManager.addListener(this._nhsMqMap.getRolloverWindow(),"opened",this._rolloverWindowOpen.bind(this));MQA.EventManager.addListener(this._nhsMqMap.getRolloverWindow(),"closed",this._rolloverWindowClose.bind(this));this._autoViewOnMapLink();this._isBuilderMap&&$jq("#nhs_CommResHideMap").hide();this._displayMapTip();$jq("#mqmaptilediv").css("z-index","0")}this._isBeingShowed=true},refresh:function(){var a=0;if(this._searchParameters==null)a=this._mqZoomLevel;else if(this._searchParameters.Radius>=10)a=7;else if(this._searchParameters.Radius==5)a=8;else if(this._searchParameters.Radius==3)a=9;else if(this._searchParameters.Radius==1)a=10;else if(this._searchParameters.City!=""||this._searchParameters.CityNameFilter!=""||this._searchParameters.PostalCode!="")a=8;else a=7;if(a!=this._nhsMqMap.getZoomLevel()||this._nhsMqMap.getCenter().getLatitude()!=this._mqCenterLat)this.zoomToLatLng(this._mqCenterLat,this._mqCenterLng,a);else this._updateMapPoints()},resetSearchArea:function(){this._mqMinLat=0;this._mqMinLng=0;this._mqMaxLat=0;this._mqMaxLng=0},viewCommunityOnMapOnHover:function(a,c,b){if(this._nhsMqMap){if(!a)var a=window.event;a.cancelBubble=true;a.stopPropagation&&a.stopPropagation();poiCollection=this._nhsMqMap.getShapes();keyToFind=""+c+b;for(i=0;i<poiCollection.getSize();i++){commPoi=poiCollection.getAt(i);if(commPoi.getKey().match(keyToFind)==keyToFind){commPoi.showRolloverWindow();break}}}},hideCommunityOnMapOnHover:function(a,c,b){if(this._nhsMqMap){if(!a)var a=window.event;a.cancelBubble=true;a.stopPropagation&&a.stopPropagation();poiCollection=this._nhsMqMap.getShapes();keyToFind=""+c+b;for(i=0;i<poiCollection.getSize();i++){commPoi=poiCollection.getAt(i);if(commPoi.getKey().match(keyToFind)==keyToFind){commPoi.mqrw&&commPoi.mqrw.hide();break}}}},viewCommunityOnMap:function(c,b,a,m,o,t,s,p,f,l,k,g,h,n,q,r,j,d,e){this._doingViewonMap=true;if(d=="true")this.get_log().logEvent("CRBLMD",b,a);else if(e=="true")this.get_log().logEvent("CRBCMD",b,a);else this.get_log().logEvent("VIEWMAP",b,a);if(this._viewOnMapLinkScript==""){c.cancelBubble=true;c.stopPropagation&&c.stopPropagation();c.preventDefault&&c.preventDefault()}!$jq("#nhs_CommResShowMap").is(".nhs_CommResShowMapOpen")&&typeof commResults!="undefined"&&commResults.showMap();poiCollection=this._nhsMqMap.getShapes();keyToFind=""+b+a;pointFound=false;for(i=0;i<poiCollection.getSize();i++){commPoi=poiCollection.getAt(i);if(commPoi.getKey().match("mkey")=="mkey"){if(commPoi.getKey().match(keyToFind)==keyToFind){pointFound=true;commPoiLatLng=commPoi.getLatLng();this._nhsMqMap.panToLatLng(commPoiLatLng);this._viewOnMapLinkScript==""&&commPoi.showRolloverWindow();break}}else if(commPoi.getKey()==keyToFind){pointFound=true;commPoiLatLng=commPoi.getLatLng();this._nhsMqMap.panToLatLng(commPoiLatLng);this._viewOnMapLinkScript==""&&commPoi.showRolloverWindow();break}}if(!pointFound&&this._nhsMqMap.getZoomLevel()>=7){commPoi=this._createCommPoi(b,a,m,o,t,s,p,f,l,k,g,h,n,q,r,j,null,null,d,e);this._nhsMqMap.addShape(commPoi);commPoi.setValue("rolloverEnabled",true);commPoiLatLng=commPoi.getLatLng();this._nhsMqMap.panToLatLng(commPoiLatLng);this._viewOnMapLinkScript==""&&commPoi.showRolloverWindow()}else if(!pointFound&&this._nhsMqMap.getZoomLevel()<7){commPoi=this._createCommPoi(b,a,m,o,t,s,p,f,l,k,g,h,n,q,r,j,null,null,d,e);this._nhsMqMap.setZoomLevel(7);commPoiLatLng=commPoi.getLatLng();this._nhsMqMap.panToLatLng(commPoiLatLng);commPoi.setValue("rolloverEnabled",true);this._nhsMqMap.addShape(commPoi);this._viewOnMapLinkScript==""&&commPoi.showRolloverWindow()}setTimeout(function(){this._doingViewonMap=false}.bind(this),1e3);$jq("html,body").animate({scrollTop:$jq("a[name='MapAnchor']").offset().top},"fast")},zoomToLatLng:function(b,c,a){this._updateResultsFlag=false;this._nhsMqMap.setCenter(new MQA.LatLng(b,c));this._nhsMqMap.setZoomLevel(a);this._updateResultsFlag=true},zoomToLatLngBC:function(d,e,a,c,b){this._updateResultsFlag=false;this._nhsMqMap.setCenter(new MQA.LatLng(d,e));this._nhsMqMap.setZoomLevel(a);!this._isBuilderMap&&this.get_log.logEvent("HOVZOOM",c,b);this._updateResultsFlag=true},_updateIFrameAd:function(b,c){var d="nhsIFrameAd"+b,a=document.getElementById(d);if(a&&a.style.display!="none")a.src=c},_resizeMapDiv:function(){var a=this._getMapSize();$jq("#"+this._mapContainerId).width(a.getWidth());$jq("#"+this._mapContainerId).height(a.getHeight())},_setMapWindowCoordinates:function(){var c=this._getMapSize(),b=this._nhsMqMap.pixToLL(new MQA.Point(0,0)),a=this._nhsMqMap.pixToLL(new MQA.Point(c.getWidth(),c.getHeight()));this._mqMinLat=b.getLatitude();this._mqMinLng=b.getLongitude();this._mqMaxLat=a.getLatitude();this._mqMaxLng=a.getLongitude();this._mqCenterLat=this._nhsMqMap.getCenter().getLatitude();this._mqCenterLng=this._nhsMqMap.getCenter().getLongitude();this._mqZoomLevel=this._nhsMqMap.getZoomLevel()},updateResults:function(){if(this._searchParameters!=null){this._searchParameters.MinLatitude=this._mqMaxLat;this._searchParameters.MinLongitude=this._mqMinLng;this._searchParameters.MaxLatitude=this._mqMinLat;this._searchParameters.MaxLongitude=this._mqMaxLng;this._commResults.saveSearchState();this.get_log().logEvent("MAPUPD",0,0);this._commResults.updateResults()}},browserResize:function(){var a=this._getBrowserSize();(this._prevBrowserSize.getWidth()!=a.getWidth()||this._prevBrowserSize.getHeight()!=a.getHeight())&&this._resizeMap();this._prevBrowserSize=a;if(this._isBuilderMap)var b=setTimeout("builderShowCase.get_map().browserResize()",250);else var c=setTimeout("commResults.get_map().browserResize()",250)},_resizeMap:function(){var a=this._getMapSize();this._nhsMqMap.setSize(a);$jq("#"+this._mapContainerId).width(a.getWidth());$jq("#"+this._mapContainerId).height(a.getHeight())},_getMapSize:function(){var b=this._mapWidth,a=this._mapHeight;return new MQA.Size(b,a)},_getBrowserSize:function(){var a=new MQA.Size(0,0);if(document.body.scrollHeight>document.body.offsetHeight){a.width=document.body.scrollWidth;a.height=document.body.scrollHeight}else{a.width=document.body.offsetWidth;a.height=document.body.offsetHeight}if(document.body.clientWidth){a.width=document.body.clientWidth;a.height=document.body.clientHeight}else{a.width=document.body.offsetWidth;a.height=document.body.offsetHeight}if(document.documentElement.clientWidth){a.width=document.documentElement.clientWidth;a.height=document.documentElement.clientHeight}if(self.innerWidth){a.width=self.innerWidth;a.height=self.innerHeight}return a},_renderPoiCollection:function(a){if(this._mqZoom<7||a.getSize()==0)$jq("#"+this._searchMapAreaParagraphId).hide();else $jq("#"+this._searchMapAreaParagraphId).show();this._nhsMqMap.replaceShapes(a)},_mapMoveEnd:function(){if(this._updateMapFlag&&!this._doingViewonMap){this.get_log().logEvent("MAPDRAG",0,0);this._showMapStatus();this._setMapWindowCoordinates();this._updateMapPoints();this._updateResultsFlag&&this.updateResults()}},_zoomEnd:function(a){if(a.zoom<7)$jq("#"+this._searchMapAreaParagraphId).hide();else $jq("#"+this._searchMapAreaParagraphId).show();this._setMapWindowCoordinates();this._updateMapPoints();this._updateResultsFlag&&this.updateResults()},_infoWindowOpen:function(){if(typeof commResults!="undefined"){commResults.get_map().get_updateMapFlag(false);!this._isBuilderMap&&commResults.get_map().get_log().logEvent("MAPCLICK",0,0);tb_init(".nhs_CommResHoverBox a.thickbox, .nhs_MultiHoverBox a.thickbox")}},_infoWindowClose:function(){typeof commResults!="undefined"&&commResults.get_map().get_updateMapFlag(true)},_rolloverWindowOpen:function(){this._updateMapFlag=false},_rolloverWindowClose:function(){this._updateMapFlag=true},_autoViewOnMapLink:function(){if(this._viewOnMapLinkScript!=""){eval(this._viewOnMapLinkScript);this._hideMapStatus()}},_hideMapStatus:function(){$jq("#"+this._mapLoadingId).hide()},_showMapStatus:function(){$jq("#"+this._mapLoadingId).show()},_updateMapPoints:function(){var d=this._mqMinLat,e=this._mqMinLng,b=this._mqMaxLat,c=this._mqMaxLng,f=this._maxResults;this._showMapStatus();var a=this._nhsMqMap.getZoomLevel();if(a<4&&!this._isBuilderMap)this._getStateMapPois(d,e,b,c);else if(a<7&&(this._isBuilderMap&&a<6))this._getMarketMapPois(d,e,b,c);else this._getCommMapPois(this._searchParameters,d,e,b,c,f)},_getCommMapPois:function(a,e,f,c,d,b){if(this._isBuilderMap)$jq.ajax({url:this._mapCommsAction,data:{partnerId:this._partnerId,brandId:this._brandId,marketId:this._marketId},success:this._onCommPoiSuccess.bind(this)});else $jq.ajax({url:this._mapCommsAction,data:{searchParameters:NHS.Scripts.Helper.JSON.toString(a),minLat:this._mqMinLat,minLng:this._mqMinLng,maxLat:this._mqMaxLat,maxLng:this._mqMaxLng,maxResults:b},success:this._onCommPoiSuccess.bind(this)})},_getMarketMapPois:function(){if(this._isBuilderMap)$jq.ajax({url:this._mapMarketsAction,data:{partnerId:this._partnerId,brandId:this._brandId,minLat:this._mqMinLat,minLng:this._mqMinLng,maxLat:this._mqMaxLat,maxLng:this._mqMaxLng},success:this._onMarketPoiSuccess.bind(this)});else $jq.ajax({url:this._mapMarketsAction,data:{partnerId:this._partnerId,minLat:this._mqMinLat,minLng:this._mqMinLng,maxLat:this._mqMaxLat,maxLng:this._mqMaxLng},success:this._onMarketPoiSuccess.bind(this)})},_getStateMapPois:function(){$jq.ajax({url:this._mapStatesAction,data:{partnerId:this._partnerId,minLat:this._mqMinLat,minLng:this._mqMinLng,maxLat:this._mqMaxLat,maxLng:this._mqMaxLng},success:this._onStatePoiSuccess.bind(this)})},_onMarketPoiSuccess:function(a){var e=new MQA.ShapeCollection;a=eval(a);for(i=0;i<a.length;i++){var h=a[i].Id,f=a[i].Lat,g=a[i].Lng,d=a[i].Title,n=a[i].Content,c='<div class="nhs_CommResHoverMarket">';if(this._isBuilderMap){var j=this._siteRoot+this._communityResultsPage+"/market-"+h+"/brandid-"+this._brandId,m=d.substring(0,d.indexOf("(")).replace("<strong>",""),l=d.substring(d.indexOf("(")).replace("</strong>","");c+='<h2><a href="'+j+'" >'+m+"</a></h2> <p>by "+this._brandName+"</p> <p>"+l+"</p>";c+="</div>"}else{c+='<a href="javascript:void(0);" onclick="if(typeof commResults != \'undefined\') commResults.get_map().zoomToLatLng('+f+","+g+',7);">View Communities in '+n+"</a>";c+="</div>"}var k=new MQA.LatLng(f,g),b=new MQA.Poi(k,this._nhsMapIconMkt);b.setValue("iconOffset",this._mqIconMktOffset);b.setValue("shadow",this._nhsMapIconShadow);b.setValue("infoTitleHTML","<strong>"+d+"</strong>");b.setValue("infoContentHTML",c);b.setValue("key",h);e.add(b)}this._renderPoiCollection(e);this._hideMapStatus()},_onStatePoiSuccess:function(a){var e=new MQA.ShapeCollection;a=eval(a);for(i=0;i<a.length;i++){var f=a[i].Lat,g=a[i].Lng,d=a[i].StateName,h=a[i].TotalCommunities,c='<div class="nhsCommResHoverState">';c+='<a href="javascript:void(0);" onclick="if(typeof commResults != \'undefined\') commResults.get_map().zoomToLatLng('+f+","+g+',4);">View Markets in '+d+"</a>";c+="</div>";var j=new MQA.LatLng(f,g),b=new MQA.Poi(j,this._nhsMapIconMkt);b.setValue("iconOffset",this._mqIconMktOffset);b.setValue("shadow",this._nhsMapIconShadow);b.setValue("infoTitleHTML","<strong>"+d+" ("+h+" communities)</strong>");b.setValue("infoContentHTML",c);b.setValue("key",d);e.add(b)}this._renderPoiCollection(e);this._hideMapStatus();typeof this._commResults!="undefined"&&this._commResults.hideProgressIndicator()},_onCommPoiSuccess:function(b){if(this._viewOnMapLinkScript==""){var a=this._buildCommPois(b),c=(eval(b))[0];c>this._maxResults&&this._displayMapMaxResultsMsg(a.getSize());this._renderPoiCollection(a);typeof this._commResults!="undefined"&&this._commResults.hideProgressIndicator()}else this._viewOnMapLinkScript="";this._hideMapStatus()},_buildCommPois:function(f){var G=new MQA.ShapeCollection;f=eval(f);var t=[],l=[].concat(f),r=f.length-1;for(i=r-1;i>0;i--){var q=f[i].split(";"),g=q[0],o=q[1],x=q[13],y=q[14],u="",U=1,K=l.length;for(j=K-1;j>=0;j--){var p=l[j].split(";"),db=p[0],cb=p[1],ab=p[13],bb=p[14];if(ab==x&&bb==y){U++;u+=l[j];l.splice(j,1)}}l.splice(i,1);u!=""&&t.push(u)}t.reverse();f=t;r=f.length;for(i=0;i<r;i++){var a=f[i].split(";"),s=a.length;if(s==19)var g=a[0],o=a[1],n=a[2],w=a[3],A=a[4],z=a[5],e=a[6],W=a[7],k=a[8],I=a[9],Y=a[10],Z=a[11],v=a[12],x=a[13],y=a[14],H=a[15],d=a[16]=="True",h=a[17]=="True",X=false,V=false,F=this._createCommPoi(g,o,n,w,A,z,e,W,k,I,Y,Z,v,x,y,H,X,V,d,h);else if(s>19){var m=(s-1)/18,J="mkey",b=[];b.push('<div class="nhs_MultiHoverBox">');var d=false,h=false,B=0,C=0;for(j=0;j<m;j++){var c=18*j,g=a[0+c],o=a[1+c],n=a[2+c],w=a[3+c],A=a[4+c],z=a[5+c],e=a[6+c],W=a[7+c],k=a[8+c],I=a[9+c],Y=a[10+c],Z=a[11+c],v=a[12+c],x=a[13+c],y=a[14+c],H=a[15+c],d=a[16+c]=="True",h=a[17+c]=="True";if(d)B++;if(h)C++;J+="_"+g+o;b.push('<div class="nhs_MultiHoverRow">');if(e=="N"||e=="n"||e=="")if(d||h)e=this._resourceRoot+"globalresourcesmvc/default/images/nophoto_75x58.png";else e=this._resourceRoot+"globalresourcesmvc/default/images/nophoto_sm.png";else e=this._resourceRoot.substring(0,this._resourceRoot.length-1)+e;var Q=this._siteRoot+this._basicListingPage+"/"+g+"/"+(n+"-"+w+"-"+A+"-"+z).replace(" ","-").trim(),O=this._siteRoot+this._basicCommPage+"/community"+g+"/"+(n+"-"+w+"-"+A+"-"+z).replace(" ","-").trim(),S=this._siteRoot+this._communityPage+"/community-"+g+"/builder-"+o,N=this._resourceRoot+"GlobalResourcesMvc/Default/images/icons/icon2_coming_soon_overlay.png",E=d?Q:h?O:S,L=d?"CRBLMD":"bcMapDetailBtn",P=" onclick=\"if(typeof commResults != 'undefined') commResults.get_map().get_log().logBasicListingAndRedirect(event,'"+E+"', '"+L+"',"+g+'); return false;">',R=" onclick=\"if(typeof commResults != 'undefined') commResults.get_map().get_log().logAndRedirect(event,'"+E+"/logevent-HOVNAME', 'HOVNAME', "+g+","+o+'); return false;">',D=d||h?P:R;b.push('<div class="nhs_ResultsThumb"><a ');b.push(D);b.push('<img src="');b.push(e);b.push('" alt="');b.push(n);b.push('" />');b.push("</a>");v=="comingsoon"&&b.push('<img src="'+N+'" class="nhs_ResultThumbComingSoonImg" alt="Coming Soon"/>');b.push("</div>");b.push("<h3><a ");b.push(D);b.push(n);b.push("</a></h3>");if(!d&&!h){b.push('<p class="nhs_ResultsBuilder">by ');b.push(I);b.push("</p>")}if(k!="$ - $"&&k!="$2,147,483,647 - $"){b.push('<p class="nhs_ResultsPrice">'+(!d?"from ":""));if(d)b.push(k.substring(0,k.indexOf(" - ")));else b.push(k);b.push("</p>")}if(!d&&!h&&!this._isBuilderMap&&v!="comingsoon"){var T=this._freeBrochureLink.replace("-text-","Free brochure").replace("-commid-",g).replace("-builderid-",o).replace("-marketid-",H).replace("-logEvent-","HOVFBROCH");b.push("<p>"+T+"</p>")}b.push('<br style="clear: both;" />');b.push("</div>")}if(m>2)b.push("</div></div>");else b.push("</div>");d=B==m||C==m;var M=b.join("");F=this._createMultiCommPoi(m,J,M,x,y,d)}G.add(F)}return G},_createCommPoi:function(e,h,g,l,n,m,c,F,f,z,H,I,k,A,B,y,G,E,b,d){var K="",J="",C=false,D=this._nhsMqMap.getZoomLevel(),q=this._resourceRoot+"GlobalResourcesMvc/Default/images/icons/icon2_coming_soon_overlay.png";if(c=="N"||c=="n"||c=="")if(b||d)c=this._resourceRoot+"globalresourcesmvc/default/images/nophoto_75x58.png";else c=this._resourceRoot+"globalresourcesmvc/default/images/nophoto_sm.png";else c=this._resourceRoot.substring(0,this._resourceRoot.length-1)+c;var a=[],u=this._siteRoot+this._basicListingPage+"/"+e+"/"+(g+"-"+l+"-"+n+"-"+m).replace(" ","-").trim(),s=this._siteRoot+this._basicCommPage+"/community-"+e+"/"+(g+"-"+l+"-"+n+"-"+m).replace(" ","-").trim(),w=this._siteRoot+this._communityPage+"/community-"+e+"/builder-"+h,j=b?u:d?s:w,o=b?"CRBLMD":"bcMapDetailBtn",t=" onclick=\"if(typeof commResults != 'undefined') commResults.get_map().get_log().logBasicListingAndRedirect(event,'"+j+"', '"+o+"',"+e+'); return false;">',v=" onclick=\"if(typeof commResults != 'undefined') commResults.get_map().get_log().logAndRedirect(event,'"+j+"/logevent-HOVNAME', 'HOVNAME', "+e+","+h+'); return false;">',i=b||d?t:v;if(b||d)a.push('<div class="nhs_CommResHoverBox nhs_BasicHoverBox">');else a.push('<div class="nhs_CommResHoverBox">');a.push('<div class="nhs_ResultsThumb"><a ');a.push(i);a.push('<img src="'+c);a.push('" alt="');a.push(g);a.push('" /></a>');k=="comingsoon"&&a.push('<img src="'+q+'" class="nhs_ResultThumbComingSoonImg" alt="Coming Soon"/>');a.push("</div>");a.push("<h3><a ");a.push(i);a.push(g);a.push("</a></h3>");if(!b&&!d){a.push('<p class="nhs_ResultsBuilder">by ');a.push(z);a.push("</p>")}if(f!="$ - $"&&f!=""&&f!="$2,147,483,647 - $"){a.push('<p class="nhs_ResultsPrice">'+(!b?"from ":""));if(b)a.push(f.substring(0,f.indexOf(" - ")));else a.push(f);a.push("</p>")}a.push('<p class="nhs_ResultsLink"><a ');a.push(i);a.push((b?"View Details":"See new homes, <br />photos and floor plans")+"</a>");a.push("</p>");if(!b&&!d&&!this._isBuilderMap&&k!="comingsoon"){var x=this._freeBrochureLink.replace("-text-","Free brochure").replace("-commid-",e).replace("-builderid-",h).replace("-marketid-",y).replace("-logEvent-","HOVFBROCH");a.push("<p>"+x+"</p>")}a.push("</div>");var p=a.join(""),r=new MQA.LatLng(A,B);mqPoint=new MQA.Poi(r,b||d?this._nhsBLMapIcon:this._nhsMapIcon);mqPoint.setValue("iconOffset",this._mqIconOffset);mqPoint.setValue("shadow",this._nhsMapIconShadow);mqPoint.setValue("infoTitleHTML","<strong>"+g+"</strong>");mqPoint.setValue("infoContentHTML",p);mqPoint.setValue("key",e+h);mqPoint.setValue("onclick","alert('onclick')");return mqPoint},_createMultiCommPoi:function(d,e,c,f,g,a){var b=new MQA.LatLng(f,g);mqPoint=new MQA.Poi(b,a?this._nhsBLMapIcon:this._nhsMapIconMult);mqPoint.setValue("iconOffset",a?this._mqIconOffset:this._mqIconMultOffset);mqPoint.setValue("shadow",this._nhsMapIconShadow);mqPoint.setValue("infoTitleHTML","<strong>"+d+" communities</strong>");mqPoint.setValue("infoContentHTML",c);mqPoint.setValue("key",e);return mqPoint},_displayMapTip:function(){$jq("#"+this._mapTipBox).css("left",$jq("#"+this._mapContainerId).width()/2-$jq("#"+this._mapTipBox).width()/2+"px");$jq("#"+this._mapTipBox).show("medium");$jq("#"+this._mapContainerId).mouseenter(function(){$jq("#"+this._mapTipBox).is(":visible")&&$jq("#"+this._mapTipBox).hide("medium")}.bind(this))},_displayMapMaxResultsMsg:function(a){$jq("#"+this._mapMaxResultsMsgId).show("medium");$jq("#"+this._mapMaxResultsMsgId+" p").text($jq("#"+this._mapMaxResultsMsgId+" p").text().replace("[pincount]",a));setTimeout(function(){$jq("#"+this._mapMaxResultsMsgId).hide("medium")}.bind(this),4e3)}};NHS.Scripts.CommunityResults.Sorting=function(a){this.onSort=a.onSort};NHS.Scripts.CommunityResults.Sorting.prototype={initialize:function(){this._sortingHandler=NHS.Scripts.Helper.createDelegate(this,this._onSort);$jq(".nhs_Sorting select").change(this._sortingHandler)},_onSort:function(a){this.onSort.call(this,$jq(a.target).find("option:selected").val())}};NHS.Scripts.Paging=function(a){this._currentPage=0;this.onGoToPage=a.onGoToPage};NHS.Scripts.Paging.prototype={get_currentPage:function(){return this._currentPage},initialize:function(){this._currentPage=Number($jq("#txtPageNumber").val());this._previousHandler=NHS.Scripts.Helper.createDelegate(this,this._onPreviousClick);this._nextHandler=NHS.Scripts.Helper.createDelegate(this,this._onNextClick);this._goHandler=NHS.Scripts.Helper.createDelegate(this,this._onGoClick);$jq("#btnPrevious").click(this._previousHandler);$jq("#btnNext").click(this._nextHandler);$jq("#aGo").click(this._goHandler)},_onPreviousClick:function(){this.onGoToPage.call(this,this._currentPage-1,"PAGEPREV")},_onNextClick:function(){this.onGoToPage.call(this,this._currentPage+1,"PAGENEXT")},_onGoClick:function(){this.onGoToPage.call(this,Number($jq("#txtPageNumber").val()),"PAGEGO")}};function onTemplateLoaded(a){_bcExperienceID=a;commResults.get_mp().loadMediaPlayer("results")}NHS.Scripts.CommunityResults.CommResults=function(a){this._parameters=a;this.validateSearchTextFunction=a.validateSearchTextFunction;this._hideDelay=500;this._hideTimer=null;this._ajaxCall=null;this._wasAlreadyCreated=false;this._openQuickViewCommunityId=null;this._MarketIdForBroshure=a.marketId;this.UrlForBrosure=a.urlForBrosure;this._CurrentPageForBrosure=a.currentPageForBrosure;this._searchParameters=a.searchParameters;this._searchAction=a.searchAction;this.method=a.method;this.partnerID=a.partnerID;this.brandPartnerId=a.brandPartnerId;this._adAction=a.adAction;this._pageSize=a.pageSize;this._resourceRoot=a.resourceRoot;this._quickViewUrl=("/"+a.partnerSiteUrl+"/CommunityResults/QuickView").replace("//","/");_marketIdCR=a.marketId;if(this._searchAction.indexOf("//"!=-1))this._searchAction=this._searchAction.replace("//","/");if(this._adAction.indexOf("//"!=-1))this._adAction=this._adAction.replace("//","/");this._tabsControlId=a.tabsControlId;this._loadingControlId=a.loadingControlId;this._listHubBasicListinIds=a.listHubBasicListinIds;this._listHubBasicListinIdsList=a.listHubBasicListinIdsList.replace("]","").replace("[","").split(",");this._listHubProviderId=a.listHubProviderId;this._listHubTestLogging=a.listHubTestLogging;this._desckey=a.desckey;this._log=new NHS.Scripts.Globals.EventLogger({siteRoot:a.siteRoot,partnerId:a.partnerId,marketId:a.marketId});this._lastLocationName="";this._lastCity="";this._lastCounty="";this._lastZipCode="";this._searchUrl=a.searchUrl;var b={locationSliderControlId:"nhs_FacetLocationSlider",locationSliderTextId:"nhs_FacetLocationText",priceSliderControlId:"nhs_FacetPriceSlider",priceSliderTextFromId:"nhs_FacetPriceTextFrom",priceSliderTextToId:"nhs_FacetPriceTextTo",sqFtSliderControlId:"nhs_FacetSqFtSlider",sqFtSliderTextFromId:"nhs_FacetSqFeetTextFrom",sqFtSliderTextToId:"nhs_FacetSqFeetTextTo",facetModalCities:"nhs_FacetModalCities",facetModalStatus:"nhs_FacetModalStatus",facetModalBedrooms:"nhs_FacetModalBedrooms",facetModalBathrooms:"nhs_FacetModalBathrooms",facetModalPromotions:"nhs_FacetModalPromotions",facetModalVideo:"nhs_FacetModalVideo",facetModalEvent:"nhs_FacetModalEvent",facetModalBuilder:"nhs_BuilderPromoList",facetLinkBuilder:"nhs_FacetLinkBuilder",facetModalSchools:"nhs_FacetModalSchools",facetModalAmenities:"nhs_FacetModalAmenities",searchParameters:this._searchParameters,locationControlId:"LocationName",locationButtonControlId:"btnGo",pageSize:a.pageSize,autoCompleteAction:a.autoCompleteAction,commResults:this,validateSearchTextFunction:this.validateSearchTextFunction};this._facets=new NHS.Scripts.CommunityResults.Facets(b);var c={MapOptions:{Latitude:a.Map.centerLat,Longitude:a.Map.centerLng,Zoom:a.Map.zoomLevel,ContainerName:"nhs_CommResMap",zoomControl:true,ZoomControlStyle:"SMALL",disableDefaultUI:true,Scrollwheel:false},MarkerPointOptions:{optimized:true},MinZoom:3,MarkerClustererOptions:{gridSize:40,maxZoom:18,cssName:"nhs_Cluster",imagePath:"",zoomOnClick:true,minimumClusterSize:5},UseClusterer:true,ProcessResultOptions:{Latitude:"Lat",Longitude:"Lng",Name:"Name"}};a.galleryParams.logger=this._log;this._galleryParameters=a.galleryParams;this._mp=new NHS.Scripts.MediaPlayerVideo(a.galleryParams);this._map=new NHS.Scripts.GoogleMapApi(c);this._paging=new NHS.Scripts.Paging({onGoToPage:this._goToPage.bind(this)});this._sort=new NHS.Scripts.CommunityResults.Sorting({onSort:this._sortResults.bind(this)})};NHS.Scripts.CommunityResults.CommResults.prototype={get_searchParameters:function(){return this._searchParameters},get_galleryParameters:function(){return this._galleryParameters},get_SearchAction:function(){return this._searchAction},get_map:function(){return this._map},set_lastLocationName:function(a){this._lastLocationName=a},get_hideDelay:function(){return this._hideDelay},get_hideTimer:function(){return this._hideTimer},get_openQuickViewCommunityId:function(){return this._openQuickViewCommunityId},get_log:function(){return this._log},get_mp:function(){return this._mp},set_hideTimer:function(a){this._hideTimer=a},set_openQuickViewCommunityId:function(a){this._openQuickViewCommunityId=a},set_searchParameters:function(a){if(typeof a=="string")a=$jq.evalJSON(a);this._searchParameters=a},initialize:function(){this._setUpControls();this._setupBrandCarousel();this._facets.initialize();this._paging.initialize();this._sort.initialize();this.setupMap();var a=NHS.Scripts.Helper.readCookie("mapState");a&&a=="expanded"&&this.showMap(true);$jq("#hdnAdCurrentMiddle").val($jq("#nhsIFrameAdMiddle").attr("src"));$jq("#hdnAdCurrentMiddle3").val($jq("#nhsIFrameAdMiddle3").attr("src"));$jq("#hdnAdCurrentRight2").val($jq("#nhsIFrameAdRight2").attr("src"));if(this._listHubBasicListinIds.length>0)for(i=0;i<this._listHubBasicListinIds.length;i++){var b=this._listHubBasicListinIds[i];this._log.logBasicListingEvent(this._desckey,this._listHubBasicListinIdsList[i]);this._log.logListHubEvent(this._listHubProviderId,this._listHubTestLogging,this._desckey,b)}setTimeout("$jq('.estaradefaultstyle a').click(function() {$jq.googlepush('Chat Links','Tab','Chat Now');});",5e3)},refresh:function(){this._setUpControls();this._setupBrandCarousel();this._facets.initialize();this._paging.initialize();this._sort.initialize()},update:function(){this._retrieveResults(1,null,null,true,true)},updateResults:function(){this._retrieveResults(1,null,null,false,true)},setupMap:function(){var a=this;this._map.options.Events.InfowindowTooltipReady=function(){var a=jQuery(".nhs_MapHoverCard").parent().parent(),b=a.parent().find("> div").first().find("> div");b.first().hide();b.eq(2).hide();a.next("div").hide();var d=a.width()+75,c=a.height()+75;this.infowindowTooltip.setOptions({pixelOffset:this.GetInfowindowOffset(d,c,this.map,this.infowindowTooltip.getAnchor())})};this._map.options.Events.InfowindowReady=function(){var a=jQuery("#nhs_MapCards").parent().parent(),b=a.parent().find("> div").first().find("> div");b.first().hide();b.eq(2).hide();var d=a.width()+75,c=a.height()+75;this.infowindow.setOptions({pixelOffset:this.GetInfowindowOffset(d,c,this.map,this.infowindow.getAnchor())})};this._map.options.Events.MarkerMouseOverCallBack=function(a,e,b,f){var c=jQuery("div.nhs_MapCard");if(c!=null&&c.length>0)return false;var h=a.MarketPoints.length>1?a.MarketPoints.length.toString()+" Communities":a.MarketPoints[0]["Name"],d=a.Price,g='<div class="nhs_MapHoverCard"><h2>'+h+"</h2>"+d+"</div>";e.close();b.setContent(g);b.open(this.map,f)};this._map.options.Events.MarkerMouseOutCallBack=function(d,b,a){a.close()};tb_initLive("#nhs_MapCards a.thickbox");this._map.options.Events.MarkerClickCallBack=function(b,e,h,d){h.close();d.setCursor("wait");a.get_log().logEvent("MAPCLICK",0,0);if(b.MarketPoints){for(var g=[],f=[],c=0;c<b.MarketPoints.length;c++)if(b.MarketPoints[c].IsBl)f.push(b.MarketPoints[c]["Id"]);else g.push(b.MarketPoints[c]["Id"]+"|"+b.MarketPoints[c]["NumHomes"]);jQuery.ajax({url:a._parameters.getMapCardAction,type:"GET",cache:false,data:{commIds:g.join(),basicIds:f.join()},success:function(b){if(b){e.setContent(b);e.open(a._map.map,d);d.setCursor("default")}}})}else{if(this.map.getZoom()<=5)this.map.setZoom(6);else this.map.getZoom()<=8&&this.map.setZoom(9);this.map.setCenter(d.position)}};this._map.ZoomListener=function(){a.get_log().logEvent("MAPZOOM",0,0);a.updateMapAndResults()};this._map.DragListener=function(){a.get_log().logEvent("MAPDRAG",0,0);a.updateMapAndResults()};this._map.getNameMarkerPoint=function(c,a){var b=this.options.ProcessResultOptions;if(a.MarketPoints.length>1)return a[b.Name]+" Communities";return a.MarketPoints[0][b.Name]};this._map.processResult=function(a){var c=this.options.ProcessResultOptions;a=a.Results;for(var b=0;b<a.length;b++)for(var e=this.getIconMarkerPoint(a,a[b]),d=0;d<a[b].MarketPoints.length;d++)this.createMarkerPoint(a[b][c.Latitude],a[b][c.Longitude],null,null,e,a[b])};this._map.processMarketsAndStates=function(c){for(var b=0;b<c.length;b++){var d=null,e=a._parameters.iconMulti,f=c[b]["Title"]?c[b].Title.replace("<strong>","").replace("</strong>",""):c[b]["StateName"]+"("+c[b]["TotalCommunities"]+" Communities)";this.createMarkerPoint(c[b].Lat,c[b].Lng,f,d,e,c[b])}this.hideLoading()};this._map.getIconMarkerPoint=function(d,b){var c=b.MarketPoints.length;if(a.currentResultType!="CommunityResults")c=b.HomesCount;if(a.showBasics){if(b.IsBl)return a.parameters.iconBasic;if(b.IsBasic){if(c>1)return a.parameters.iconMultiBasic;return a.parameters.iconBasic}}if(c>1)return a._parameters.iconMulti;return a._parameters.icon};this._map.options.Events.OnMapCreate=function(){a.plotMap();a._map.options.Events.OnMapCreate=null}},updateMapAndResults:function(){var a=this._map.getBoundsFromMap();this._searchParameters.MinLatitude=a.minLat;this._searchParameters.MinLongitude=a.minLng;this._searchParameters.MaxLatitude=a.maxLat;this._searchParameters.MaxLongitude=a.maxLng;this.saveSearchState();if(this._map.map.getZoom()>8)this.updateResults();else this.plotMap()},plotMap:function(){var a=this;a.get_log().logEvent("MAPUPD",0,0);if(a.isMapOpen()){a.showProgressIndicator();var b=a._map.getBoundsFromMap();a._map.map.clearOverlays();if(a._map.map.getZoom()<=5)jQuery.getJSON("/MapSearch/GetStateMapPoints",{partnerId:a._parameters.partnerID,minLat:b.maxLat,minLng:b.minLng,maxLat:b.minLat,maxLng:b.maxLng},function(b){a._map.processMarketsAndStates($jq.evalJSON(b));a.hideProgressIndicator()});else if(a._map.map.getZoom()<=8)jQuery.getJSON("/MapSearch/GetMarketMapPoints",{partnerId:a._parameters.partnerID,minLat:b.maxLat,minLng:b.minLng,maxLat:b.minLat,maxLng:b.maxLng},function(b){a._map.processMarketsAndStates($jq.evalJSON(b));a.hideProgressIndicator()});else jQuery.getJSON("/MapSearch/GetCommMapPointsV2",{searchParameters:NHS.Scripts.Helper.JSON.toString(a._searchParameters),minLat:b.maxLat,minLng:b.minLng,maxLat:b.minLat,maxLng:b.maxLng},function(b){a._map.processResult($jq.evalJSON(b));a.hideProgressIndicator()})}},saveSearchState:function(){if(this._searchParameters.City!=""||this._searchParameters.County!=""||this._searchParameters.PostalCode!=""){this._lastCity=this._searchParameters.City;this._lastCounty=this._searchParameters.County;this._lastZipCode=this._searchParameters.PostalCode;this._lastRadius=this._searchParameters.Radius;this._lastCenterLat=this.get_map()._mqCenterLat;this._lastCenterLng=this.get_map()._mqCenterLng}this._searchParameters.City="";this._searchParameters.County="";this._searchParameters.PostalCode="";this._searchParameters.Radius=0},resetSearchArea:function(){this._map.createMap()},restoreSearchState:function(){var a=this.get_map();this._searchParameters.City=this._lastCity;this._searchParameters.County=this._lastCounty;this._searchParameters.PostalCode=this._lastZipCode;a._mqCenterLat=this._lastCenterLat;a._mqCenterLng=this._lastCenterLng;this._lastCity="";this._lastCounty="";this._lastZipCode="";this._lastRadius="";this._lastCenterLat="";this._lastCenterLng=""},reset:function(a){this.set_searchParameters(a);this.update();this.hideProgressIndicator()},hideProgressIndicator:function(){$jq("#"+this._loadingControlId).hide()},showProgressIndicator:function(){$jq("#"+this._loadingControlId).show()},isMapOpen:function(){return $jq("#nhs_CommResShowMap").hasClass("nhs_CommResShowMapOpen")},showMap:function(b){var a=$jq("#nhs_CommResShowMap").position();if(a){$jq("#nhs_CommResShowMap").addClass("nhs_CommResShowMapOpen");$jq("#nhs_CommResMapMain").show();$jq("#nhs_CommResMapMain").css("top",a.top+"px");NHS.Scripts.Helper.createCookie("mapState","expanded",0)}if(b){!this._wasAlreadyCreated&&this._map.createMap();this._wasAlreadyCreated=true}else this.plotMap()},hideMap:function(){$jq("#nhs_CommResShowMap").removeClass("nhs_CommResShowMapOpen");$jq("#nhs_CommResMapMain").hide();$jq.googlepush("Search Events","Search Results","Collapse Map")},showQuickViewHomes:function(a,c){$jq(".nhs_ResultQuickView").hide();$jq(".nhs_CommResRow").removeClass("nhs_CommResRowOpen");var d=this._resourceRoot+"/globalresourcesmvc/default/images/quickview_loading.gif";$jq('div[id^="nhs_ResultQuickView"]').css("background","url("+d+") no-repeat scroll 50% 50% #FFFFFF");if($jq("#nhs_CommResRow"+a+" .nhs_ResultShowQVBtn").text()=="Show"){var b=commResults.get_searchParameters();$jq(".nhs_ResultShowQVBtn").text("Show");$jq("#nhs_CommResRow"+a+" .nhs_ResultShowQVBtn").text("Hide");$jq("#nhs_ResultQuickView"+a).show();$jq("#nhs_CommResRow"+a).addClass("nhs_CommResRowOpen");$jq(".nhs_ResultQVList").html("");$jq.ajax({url:this._quickViewUrl,type:"POST",data:{communityId:a,searchParameters:NHS.Scripts.Helper.JSON.toString(b)},success:function(b){$jq(".nhs_ResultQVList").html(b);$jq("#nhs_ResultQuickView"+a).css("background","none")}});this._log.logEvent("CRQVEXP",a,c,0,0)}else $jq(".nhs_ResultShowQVBtn").text("Show")},showQuickView:function(a){$jq(".nhs_ResultQuickView").hide();$jq(".btn_QuickViewOpen").removeClass("btn_QuickViewOpen");var c=commResults.get_openQuickViewCommunityId();if(a==c){commResults.set_openQuickViewCommunityId(null);return false}if($jq("#nhs_ResultQuickView"+a).html().length<=0){var b=commResults.get_searchParameters();$jq.ajax({url:"/CommunityResults/QuickView",type:"POST",data:{communityId:a,searchParameters:NHS.Scripts.Helper.JSON.toString(b)},success:function(b){$jq("#lnkQuickView"+a).addClass("btn_QuickViewOpen");$jq("#nhs_ResultQuickView"+a).html(b);$jq("#nhs_ResultQuickView"+a).show();$jq("#div_"+a).jCarouselLite({btnNext:"#next_"+a+", #cimgnext_"+a+", #himgnext_"+a,btnPrev:"#prev_"+a+", #cimgprev_"+a+", #himgprev_"+a,visible:1,scroll:1,circular:true});tb_init("div#nhs_ResultQuickView"+a+" a.thickbox")},error:function(c,b,a){NHS.Scripts.Helper.logError(a,"/communityResults/QuickView","error on quick view")}})}else{$jq("#nhs_ResultQuickView"+a).toggle();$jq("#lnkQuickView"+a).toggleClass("btn_QuickViewOpen")}commResults.set_openQuickViewCommunityId(a)},_setUpControls:function(){var a=this;$jq("#nhs_PageCountSelect").change(function(){this._retrieveResults(1,null,null,false,false)}.bind(this));$jq("#nhs_ImagePlayerCaption").hide();$jq("#nhs_CommResMapListCol .nhs_MapLink").click(function(c){$jq.NhsCancelEventAndStopPropagation(c);var b=$jq(this).attr("id");jQuery.googlepush("Search Events","Search Results","View on Map");a.get_log().logEvent("VIEWMAP",b.split("-")[0],b.split("-")[1])});brightcove.createExperiences();InitGallery(this._galleryParameters);$jq("#"+this._tabsControlId+" li a").click(function(){if($jq(this).attr("disabled")!=true&&$jq(this).attr("disabled")!="disabled"){if($jq(this).parent().attr("id")=="allCommunitiesTab"){a._searchParameters.SpecialOfferComm=0;a._searchParameters.HomeStatus=0}else if($jq(this).parent().attr("id")=="hotDealsTab"){a._searchParameters.SpecialOfferComm=1;a._searchParameters.HomeStatus=0}else if($jq(this).parent().attr("id")=="quickMoveInTab"){a._searchParameters.SpecialOfferComm=0;a._searchParameters.HomeStatus=5}a.update()}return false})},_goToPage:function(b,a){this._retrieveResults(b,a,null,false,false)},_setupBrandCarousel:function(){$jq("#nhs_BuilderPromoBrands div").jCarouselLite({auto:2500,speed:1e3,vertical:true,visible:1})},_sortResults:function(a){switch(a){case "Random":this._searchParameters.SortOrder=0;break;case "HomeMatches":this._searchParameters.SortOrder=3;break;case "Price":this._searchParameters.SortOrder=2;break;case "Location":this._searchParameters.SortOrder=1;break;case "Builder":this._searchParameters.SortOrder=4;break;case "Name":this._searchParameters.SortOrder=7}var b=$jq("#nhs_SortingSelect").find("option:selected"),c=b.attr("type");$jq.googlepush("Search Events","Search Refinement","Sort - "+c);this._retrieveResults(1,null,a,false,false)},_retrieveResults:function(f,c,d,g,e){$jq("#"+this._loadingControlId).show();var b=this,a={};a.searchParameters=NHS.Scripts.Helper.JSON.toString(this._searchParameters);a.page=f;a.pageSize=$jq("#nhs_PageCount").find("option:selected").val()||this._pageSize;a.trigerByFacets=e;a.showCode=$jq("#ShowCode").val();a.searchUrl=b._searchUrl;if(d!=null)a.sortColumn=d;if(c!=null)a.pageCommand=c;a.numPostbacks=$jq("#NumPostBacks").val();this._ajaxCall&&this._ajaxCall.abort();this._ajaxCall=$jq.ajax({url:this._searchAction,type:"POST",data:a,success:function(a){if(a){var c=document.write;document.write=function(a){$jq(a).appendTo("#nhs_commResultsAd")};$jq("#nhs_CommResData").html(a);(b.brandPartnerId==1||b.brandPartnerId==333)&&b.ChangeCommuntyImage();var d={position:"x01",frame:true,jsParameters:false};$jq.ajax({url:this._adAction,type:"POST",data:d,success:function(a){$jq("#nhs_FooterAdBox").html(a)}});document.write=c;adUpdater.RenderAllAds();$jq(document).ready(function(){tb_init("div.nhs_CommResRow a.thickbox");tb_init("div#nhs_FacetModalPromotions a.thickbox");b.brandPartnerId==88&&tb_init(".pro_SendSelectedBrochures a.thickbox");var a=NHS.Scripts.Helper.readCookie("mapState");this.refresh();if(a&&a=="expanded")this.showMap(false);else this.hideProgressIndicator();if($jq("#hdnAdUpdateTop").val()!=""&&$jq("#hdnAdUpdateMiddle").val()!=""&&$jq("#hdnAdUpdateMiddle3").val()!=null&&$jq("#hdnAdUpdateRight2").val()!=""){$jq("#nhsIFrameAdTop").attr("src",$jq("#hdnAdUpdateTop").val());$jq("#nhsIFrameAdMiddle").attr("src",$jq("#hdnAdUpdateMiddle").val());$jq("#nhsIFrameAdMiddle3").attr("src",$jq("#hdnAdUpdateMiddle3").val());$jq("#nhsIFrameAdRight2").attr("src",$jq("#hdnAdUpdateRight2").val())}else{$jq("#nhsIFrameAdMiddle").attr("src",$jq("#hdnAdCurrentMiddle").val());$jq("#nhsIFrameAdMiddle3").attr("src",$jq("#hdnAdCurrentMiddle3").val());$jq("#nhsIFrameAdRight2").attr("src",$jq("#hdnAdCurrentRight2").val())}var c=jQuery("#nhs_Crumbs").html();jQuery("#nhs_Crumbs").load("/common/breadcrumb",{sParams:this._searchParameters,refresh:true,marketId:this._parameters.marketId},function(b,a){a=="error"&&jQuery("#nhs_Crumbs").html(c)})}.bind(this));this.AddRemoveBrochure(this.UrlForBrosure,this._MarketIdForBroshure,this._CurrentPageForBrosure)}}.bind(this),error:function(c,b,a){NHS.Scripts.Helper.logError(a,this._searchAction,"error on search");this.hideProgressIndicator()}.bind(this)})},SaveCommunity:function(a,b){var d=this,c={communityId:a,builderId:b};$jq.ajax({type:"POST",url:d.method,data:c,success:function(b){b&&$jq("#nhs_SaveThisItem_"+a).parent().replaceWith('<span><span class="pro_Saved">Saved to Favorites</span></span>')}})},UnCheckAll:function(){$jq(".pro_ResultSendBrochure").attr("checked",false);$jq("label[for^='pro_ResultSendBrochure_']").html("Select");$jq("#pro_SendSelectedBrochuresCount").val("0");$jq(".pro_SendSelectedBrochures a.thickbox").hide();$jq(".pro_SendSelectedBrochures a.nhs_fake").show();$jq(".pro_SendSelectedBrochures a").html("Send Selected Brochures (0)")},AddRemoveBrochure:function(d,c,a){$jq(".pro_ResultSendBrochure").on("change",function(){var e=parseInt($jq("#pro_SendSelectedBrochuresCount").val()),i=true,b=$jq(this),g=b.attr("id"),f=$jq("input[id="+g+"]").length,h=$jq("input[id="+g+"]");if(b.is(":checked")){b.parent().find("label[for^='pro_ResultSendBrochure_']").html("Selected");e++;f>1&&h.each(function(){$jq(this).parent().find("label[for^='pro_ResultSendBrochure_']").html("Selected");$jq(this).attr("checked",true)})}else{b.parent().find("label[for^='pro_ResultSendBrochure_']").html("Select");e--;i=false;f>1&&h.each(function(){$jq(this).parent().find("label[for^='pro_ResultSendBrochure_']").html("Select");$jq(this).attr("checked",false)})}$jq(".pro_SendSelectedBrochures a").html("Send Selected Brochures ("+e+")");if(e==0){$jq(".pro_SendSelectedBrochures a.thickbox").hide();$jq(".pro_SendSelectedBrochures a.nhs_fake").show()}else{$jq(".pro_SendSelectedBrochures a.thickbox").show();$jq(".pro_SendSelectedBrochures a.nhs_fake").hide()}$jq("#pro_SendSelectedBrochuresCount").val(e);var j={communityId:b.attr("communityId"),builderId:b.attr("builderId"),isBilled:b.attr("isBilled"),marketId:c,add:i,isFeatured:b.attr("isFeatured"),page:a,position:b.attr("position")};$jq.ajax({type:"POST",url:d,data:j,success:function(a){$jq(".pro_SendSelectedBrochures a").html("Send Selected Brochures ("+a+")");if(a==0){$jq(".pro_SendSelectedBrochures a.thickbox").hide();$jq(".pro_SendSelectedBrochures a.nhs_fake").show()}else{$jq(".pro_SendSelectedBrochures a.thickbox").show();$jq(".pro_SendSelectedBrochures a.nhs_fake").hide()}}})});var b=$jq("input[id^=pro_ResultSendBrochure_]");b.each(function(){$jq(this).is(":checked")&&$jq(this).parent().find("label[for^='pro_ResultSendBrochure_']").html("Selected")})},ChangeCommuntyImage:function(){if($jq("#ShowAlternateImage").val()=="true"){$jq(".nhs_DefaultImages").remove();$jq(".nhs_AlterImages").show()}}};(function(a){if(typeof define==="function"&&define.amd)define(["jquery"],a);else a(jQuery)})(function(b){var e=/\+/g;function f(a){return a}function d(a){return decodeURIComponent(a.replace(e," "))}function c(b){if(b.indexOf('"')===0)b=b.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\");try{return a.json?JSON.parse(b):b}catch(c){}}var a=b.cookie=function(h,g,e){if(g!==undefined){e=b.extend({},a.defaults,e);if(typeof e.expires==="number"){var q=e.expires,p=e.expires=new Date;p.setDate(p.getDate()+q)}g=a.json?JSON.stringify(g):String(g);return document.cookie=[a.raw?h:encodeURIComponent(h),"=",a.raw?g:encodeURIComponent(g),e.expires?"; expires="+e.expires.toUTCString():"",e.path?"; path="+e.path:"",e.domain?"; domain="+e.domain:"",e.secure?"; secure":""].join("")}for(var m=a.raw?f:d,k=document.cookie.split("; "),i=h?undefined:{},j=0,r=k.length;j<r;j++){var n=k[j].split("="),o=m(n.shift()),l=m(n.join("="));if(h&&h===o){i=c(l);break}if(!h)i[o]=c(l)}return i};a.defaults={};b.removeCookie=function(a,c){if(b.cookie(a)!==undefined){b.cookie(a,"",b.extend({},c,{expires:-1}));return true}return false}});NHS.Scripts.CommunityResults.MapPopup=function(a){this.parameters=a};NHS.Scripts.CommunityResults.MapPopup.prototype={init:function(){var b=this,c=this.parameters.OptionsForMap,a=new NHS.Scripts.GoogleMapApi(c);a.getIconMarkerPoint=function(){return b.parameters.icon};a.createMap();a.options.Events.OnMarkersCreate=function(e,c,d){c.setContent(b.GetHtmlPoints(e));c.open(a.map,d)};var d=[{Latitude:b.parameters.latitude,Longitude:b.parameters.longitude,Name:b.parameters.communityName,PriceRange:b.parameters.priceRange}];a.options.Events.MarkerClickCallBack=function(e,c,f,d){c.setContent(b.GetHtmlPoints(e));c.open(a.map,d)};google.maps.event.addListener(a.map,"idle",b.RemoveGoogleInfo);a.processResult(d)},GetHtmlPoints:function(b){var a='<div class="nhs_MapHoverCard"><a class="nhs_commDetail" target=\'_top\' href=\''+this.parameters.urlDetailPage+"' >";a+="<h2>"+b.Name+'</h2><p class="nhs_Price">'+b.PriceRange+"</p>";a+="</a></div>";return a},RemoveGoogleInfo:function(){if(jQuery(".gm-style > div > a").attr("href")){for(var b=jQuery(".gm-style-cc").length,a=1;a<b;a+=1)jQuery(".gm-style-cc").eq("-1").remove();jQuery(".gm-style > div > a").removeAttr("href").removeAttr("title")}}};var player;$jq(document).ready(function(){var b=document.createElement("script");b.src="https://www.youtube.com/iframe_api";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)});function onYouTubeIframeAPIReady(){}function createPlayer(a,b,d,c){player=new YT.Player(a,{height:c,width:d,videoId:b,events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})}function onPlayerReady(a){a.target.playVideo()}function onPlayerStateChange(){}